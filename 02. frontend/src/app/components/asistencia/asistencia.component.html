<div class="container">
  <div class="welcome-section">
    <mat-card class="welcome-card">
      <mat-card-header>
        <div class="header-content">
          <div class="company-section">
            <img src="assets/logo-transmarina.png" alt="Transmarina Logo" class="company-logo">
            <div class="company-info">
              <span class="company-name">Transmarina del PERU SAC</span>
              <span class="company-sucursal">PIURA - SECHURA</span>
            </div>
          </div>
          <div class="title-section">
            <mat-card-title>
              <mat-icon class="welcome-icon">person_add</mat-icon>
              {{ getTituloSegunTipo() }}
            </mat-card-title>
            <mat-card-subtitle>
              Por favor, ingrese su DNI, código de trabajador o código de tarjeta
            </mat-card-subtitle>
          </div>
        </div>
      </mat-card-header>
      
      <mat-card-content class="card-content">
        <div class="input-section">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>DNI, Código de Trabajador o Código de Tarjeta</mat-label>
            <input 
              #codigoInputRef
              matInput 
              [(ngModel)]="codigoInput" 
              placeholder="Ej: 12345678, EMP001, o 123456789"
              (keyup.enter)="validarCodigo()"
              maxlength="20"
              autofocus
              class="codigo-input"
              [disabled]="procesandoValidacion"
            >
            <mat-icon matSuffix>badge</mat-icon>
          </mat-form-field>
          
          <button 
            mat-raised-button 
            color="primary" 
            (click)="validarCodigo()"
            [disabled]="!codigoInput || codigoInput.length < 3 || procesandoValidacion"
            class="submit-button"
          >
            <mat-icon *ngIf="!procesandoValidacion">login</mat-icon>
            <mat-icon *ngIf="procesandoValidacion" class="spinning">sync</mat-icon>
            {{ procesandoValidacion ? 'Validando...' : 'Validar Código' }}
          </button>
        </div>
        
        <div class="info-section">
          <div class="info-grid">
            <div class="info-items">
              <div class="info-item">
                <mat-icon class="info-icon">badge</mat-icon>
                <span>Acepta DNI, código de trabajador o código de tarjeta</span>
              </div>
              <div class="info-item">
                <mat-icon class="info-icon">security</mat-icon>
                <span>Validación automática en tiempo real</span>
              </div>
              <div class="info-item">
                <mat-icon class="info-icon">schedule</mat-icon>
                <span>Raciones disponibles según la hora actual</span>
              </div>
            </div>
            <div class="clock-container">
              <app-clock></app-clock>
            </div>
          </div>
        </div>
      </mat-card-content>
      
      <mat-card-actions class="card-actions">
        <button 
          mat-stroked-button 
          color="secondary" 
          (click)="volverMenuPrincipal()"
          class="back-menu-button"
        >
          <mat-icon>home</mat-icon>
          Volver al Menú Principal
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- Popup de Movimientos -->
  <app-popup-movimientos
    *ngIf="mostrarPopupMovimientos"
    [tipoMarcaje]="tipoMarcaje"
    [nombreTrabajador]="nombreTrabajador"
    [ultimoMovimiento]="ultimoMovimiento"
    (movimientoSeleccionado)="onMovimientoSeleccionado($event)"
    (cerrar)="onPopupCerrado('movimientos')"
  ></app-popup-movimientos>

  <!-- Popup de Raciones -->
  <app-popup-raciones
    *ngIf="mostrarPopupRaciones"
    [nombreTrabajador]="nombreTrabajador"
    (racionesSeleccionadas)="onRacionesSeleccionadas($event)"
    (racionOmitida)="onRacionOmitida()"
    (cerrar)="onPopupCerrado('raciones')"
  ></app-popup-raciones>

  <!-- 🔍 INDICADOR DE VERSIÓN (para verificar cache) -->
  <div class="version-indicator" title="Versión del Frontend - Para verificar cache">
    v{{ appVersion$ | async }} | {{ buildTimestamp$ | async }}
  </div>

  <!-- Loader de Procesamiento API -->
  <div class="api-loader-overlay" *ngIf="procesandoMarcacion">
    <div class="api-loader-content">
      <mat-spinner diameter="60" color="primary"></mat-spinner>
      <div class="loader-text">
        <h3>🎫 Generando Ticket</h3>
        <p>Procesando marcación para:</p>
        <p class="worker-name">{{ nombreTrabajador }}</p>
        <p class="processing-info">Por favor, espere un momento...</p>
      </div>
    </div>
  </div>
</div>
