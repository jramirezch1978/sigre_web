$PBExportHeader$w_rh030_abc_maestro_personal.srw
forward
global type w_rh030_abc_maestro_personal from w_abc
end type
type st_alerta from statictext within w_rh030_abc_maestro_personal
end type
type rr_1 from roundrectangle within w_rh030_abc_maestro_personal
end type
type st_ficha1 from statictext within w_rh030_abc_maestro_personal
end type
type pb_ficha1 from picturebutton within w_rh030_abc_maestro_personal
end type
type st_rows from statictext within w_rh030_abc_maestro_personal
end type
type cbx_activos from checkbox within w_rh030_abc_maestro_personal
end type
type p_foto from picture within w_rh030_abc_maestro_personal
end type
type st_campo from statictext within w_rh030_abc_maestro_personal
end type
type dw_3 from datawindow within w_rh030_abc_maestro_personal
end type
type pb_refrescar from picturebutton within w_rh030_abc_maestro_personal
end type
type pb_imprimir from picturebutton within w_rh030_abc_maestro_personal
end type
type st_imprimir from statictext within w_rh030_abc_maestro_personal
end type
type st_refrescar from statictext within w_rh030_abc_maestro_personal
end type
type p_2 from picture within w_rh030_abc_maestro_personal
end type
type dw_lista from u_dw_abc within w_rh030_abc_maestro_personal
end type
type tab_1 from tab within w_rh030_abc_maestro_personal
end type
type tabpage_1 from userobject within tab_1
end type
type shl_3 from statichyperlink within tabpage_1
end type
type shl_1 from statichyperlink within tabpage_1
end type
type dw_detail from u_dw_abc within tabpage_1
end type
type tabpage_1 from userobject within tab_1
shl_3 shl_3
shl_1 shl_1
dw_detail dw_detail
end type
type tabpage_6 from userobject within tab_1
end type
type dw_rtps from u_dw_abc within tabpage_6
end type
type tabpage_6 from userobject within tab_1
dw_rtps dw_rtps
end type
type tabpage_2 from userobject within tab_1
end type
type dw_detail_carga_det from u_dw_abc within tabpage_2
end type
type dw_detail_carga from u_dw_abc within tabpage_2
end type
type tabpage_2 from userobject within tab_1
dw_detail_carga_det dw_detail_carga_det
dw_detail_carga dw_detail_carga
end type
type tabpage_3 from userobject within tab_1
end type
type dw_detail_otros from u_dw_abc within tabpage_3
end type
type tabpage_3 from userobject within tab_1
dw_detail_otros dw_detail_otros
end type
type tabpage_4 from userobject within tab_1
end type
type dw_tarjetas from u_dw_abc within tabpage_4
end type
type tabpage_4 from userobject within tab_1
dw_tarjetas dw_tarjetas
end type
type tabpage_5 from userobject within tab_1
end type
type dw_cargos from u_dw_abc within tabpage_5
end type
type tabpage_5 from userobject within tab_1
dw_cargos dw_cargos
end type
type tabpage_7 from userobject within tab_1
end type
type dw_establecimientos from u_dw_abc within tabpage_7
end type
type tabpage_7 from userobject within tab_1
dw_establecimientos dw_establecimientos
end type
type tabpage_8 from userobject within tab_1
end type
type dw_periodos_laborales from u_dw_abc within tabpage_8
end type
type tabpage_8 from userobject within tab_1
dw_periodos_laborales dw_periodos_laborales
end type
type tabpage_9 from userobject within tab_1
end type
type tab_2 from tab within tabpage_9
end type
type tabpage_10 from userobject within tab_2
end type
type dw_basc_infgen from u_dw_abc within tabpage_10
end type
type tabpage_10 from userobject within tab_2
dw_basc_infgen dw_basc_infgen
end type
type tabpage_11 from userobject within tab_2
end type
type dw_basc_ciuvis from u_dw_abc within tabpage_11
end type
type tabpage_11 from userobject within tab_2
dw_basc_ciuvis dw_basc_ciuvis
end type
type tabpage_12 from userobject within tab_2
end type
type dw_estrea from u_dw_abc within tabpage_12
end type
type tabpage_12 from userobject within tab_2
dw_estrea dw_estrea
end type
type tabpage_13 from userobject within tab_2
end type
type dw_actfin from u_dw_abc within tabpage_13
end type
type tabpage_13 from userobject within tab_2
dw_actfin dw_actfin
end type
type tabpage_14 from userobject within tab_2
end type
type dw_otrcta from u_dw_abc within tabpage_14
end type
type tabpage_14 from userobject within tab_2
dw_otrcta dw_otrcta
end type
type tabpage_15 from userobject within tab_2
end type
type dw_soccom from u_dw_abc within tabpage_15
end type
type tabpage_15 from userobject within tab_2
dw_soccom dw_soccom
end type
type tabpage_16 from userobject within tab_2
end type
type st_5 from statictext within tabpage_16
end type
type dw_docesc from u_dw_abc within tabpage_16
end type
type cb_3 from commandbutton within tabpage_16
end type
type sle_tipodocescaneado from singlelineedit within tabpage_16
end type
type st_3 from statictext within tabpage_16
end type
type cb_1 from commandbutton within tabpage_16
end type
type sle_rutaarchivo from singlelineedit within tabpage_16
end type
type sle_archiobs from singlelineedit within tabpage_16
end type
type st_4 from statictext within tabpage_16
end type
type dp_1 from datepicker within tabpage_16
end type
type st_2 from statictext within tabpage_16
end type
type cb_2 from commandbutton within tabpage_16
end type
type tabpage_16 from userobject within tab_2
st_5 st_5
dw_docesc dw_docesc
cb_3 cb_3
sle_tipodocescaneado sle_tipodocescaneado
st_3 st_3
cb_1 cb_1
sle_rutaarchivo sle_rutaarchivo
sle_archiobs sle_archiobs
st_4 st_4
dp_1 dp_1
st_2 st_2
cb_2 cb_2
end type
type tab_2 from tab within tabpage_9
tabpage_10 tabpage_10
tabpage_11 tabpage_11
tabpage_12 tabpage_12
tabpage_13 tabpage_13
tabpage_14 tabpage_14
tabpage_15 tabpage_15
tabpage_16 tabpage_16
end type
type tabpage_9 from userobject within tab_1
tab_2 tab_2
end type
type tab_1 from tab within w_rh030_abc_maestro_personal
tabpage_1 tabpage_1
tabpage_6 tabpage_6
tabpage_2 tabpage_2
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_5 tabpage_5
tabpage_7 tabpage_7
tabpage_8 tabpage_8
tabpage_9 tabpage_9
end type
type dw_master from u_dw_abc within w_rh030_abc_maestro_personal
end type
end forward

global type w_rh030_abc_maestro_personal from w_abc
integer width = 6066
integer height = 2708
string title = "[RH030] Mantenimiento de Personal"
string menuname = "m_master_simple"
event ue_retrieve_lista ( )
event ue_print_ficha_eleccion ( )
st_alerta st_alerta
rr_1 rr_1
st_ficha1 st_ficha1
pb_ficha1 pb_ficha1
st_rows st_rows
cbx_activos cbx_activos
p_foto p_foto
st_campo st_campo
dw_3 dw_3
pb_refrescar pb_refrescar
pb_imprimir pb_imprimir
st_imprimir st_imprimir
st_refrescar st_refrescar
p_2 p_2
dw_lista dw_lista
tab_1 tab_1
dw_master dw_master
end type
global w_rh030_abc_maestro_personal w_rh030_abc_maestro_personal

type variables
String 	is_accion,is_col,is_tipo, is_emp = 'EMP', is_Jor ='JOR', is_EJO='EJO'
String	is_not_imagen

u_dw_abc idw_detail, idw_detail_carga, idw_detail_carga_det, idw_detail_otros, &
			idw_tarjetas, idw_cargos, idw_rtps, idw_establecimientos, idw_periodos_laborales , &
			idw_basc_infgen, idw_basc_ciuvis, idw_basc_estrea, idw_basc_actfin, idw_basc_otrcta, idw_basc_soccom, idw_basc_docesc

string is_nombre_archivo


end variables

forward prototypes
public function integer of_nro_item (datawindow adw_pr)
public subroutine of_asigna_dws ()
public subroutine of_load_foto (string as_codtra)
public subroutine of_retrieve_item (long al_row)
public subroutine of_insert_lista_trab ()
end prototypes

event ue_retrieve_lista();this.event ue_update_request()

if cbx_activos.checked then
	dw_lista.dataObject = 'd_abc_lista_trabajadores_activos_tbl'
else
	dw_lista.dataObject = 'd_abc_lista_trabajadores_tbl'
end if

dw_lista.setTransObject(SQLCA)
dw_lista.Retrieve(gs_origen, gs_user)

if dw_lista.RowCount() > 0 then
	dw_lista.setRow(1)
	dw_lista.selectrow( 0, false )
	dw_lista.selectrow( 1, true )
	
	this.of_retrieve_item( 1 )

else
	dw_master.Reset()
	idw_detail.Reset()
	idw_detail_carga.Reset()
	idw_tarjetas.Reset()
	idw_cargos.Reset()
	idw_establecimientos.Reset()
	idw_basc_infgen.Reset()
	idw_basc_ciuvis.Reset()
	idw_basc_estrea.Reset()
	idw_basc_actfin.Reset()
	idw_basc_otrcta.Reset()
	idw_basc_soccom.Reset()
	idw_basc_docesc.Reset()

	dw_master.ii_update = 0
	idw_detail.ii_update = 0
	idw_detail_carga.ii_update = 0
	idw_tarjetas.ii_update = 0
	idw_cargos.ii_update = 0
	idw_establecimientos.ii_update = 0
	idw_basc_infgen.ii_update = 0
	idw_basc_ciuvis.ii_update = 0
	idw_basc_estrea.ii_update = 0
	idw_basc_actfin.ii_update = 0
	idw_basc_otrcta.ii_update = 0
	idw_basc_soccom.ii_update = 0
	idw_basc_docesc.ii_update = 0
	
	dw_master.ResetUpdate()
	idw_detail.ResetUpdate()
	idw_detail_carga.ResetUpdate()
	idw_tarjetas.ResetUpdate()
	idw_cargos.ResetUpdate()
	idw_establecimientos.ResetUpdate()
	idw_basc_infgen.ResetUpdate()
	idw_basc_ciuvis.ResetUpdate()
	idw_basc_estrea.ResetUpdate()
	idw_basc_actfin.ResetUpdate()
	idw_basc_otrcta.ResetUpdate()
	idw_basc_soccom.ResetUpdate()
	idw_basc_docesc.ResetUpdate()
	

end if

st_rows.Text = String(dw_lista.RowCount(), '###,##0')
end event

event ue_print_ficha_eleccion();// vista previa de mov. almacen
str_parametros lstr_rep

if dw_master.rowcount() = 0 then return

lstr_rep.dw1 		= 'd_rpt_formato_eleccion_snp_afp_tbl'
lstr_rep.titulo 	= 'Pervio de Formato de Eleccion de Sistema de Pensiones'
lstr_rep.string1 	= '%%'
lstr_rep.string2 	= '%%'
lstr_rep.string3 	= dw_master.object.cod_trabajador	[dw_master.getrow()]
lstr_rep.tipo		= '1S2S3S'

OpenSheetWithParm(w_rpt_preview, lstr_rep, w_main, 0, Layered!)
end event

public function integer of_nro_item (datawindow adw_pr);integer li_item, li_x

li_item = 0

For li_x 		= 1 to adw_pr.RowCount()
	IF li_item 	< long(adw_pr.object.SECUENCIA[li_x]) THEN
		li_item 	= long(adw_pr.object.SECUENCIA[li_x])
	END IF
Next

Return li_item + 1
end function

public subroutine of_asigna_dws ();
idw_detail 					= tab_1.tabpage_1.dw_detail
idw_detail_carga 			= tab_1.tabpage_2.dw_detail_carga
idw_detail_carga_det		= tab_1.tabpage_2.dw_detail_carga_det
idw_detail_otros			= tab_1.tabpage_3.dw_detail_otros
idw_tarjetas				= tab_1.tabpage_4.dw_tarjetas
idw_cargos					= tab_1.tabpage_5.dw_cargos
idw_rtps						= tab_1.tabpage_6.dw_rtps
idw_establecimientos		= tab_1.tabpage_7.dw_establecimientos
idw_periodos_laborales	= tab_1.tabpage_8.dw_periodos_laborales
idw_basc_infgen			= tab_1.tabpage_9.tab_2.tabpage_10.dw_basc_infgen
idw_basc_ciuvis			= tab_1.tabpage_9.tab_2.tabpage_11.dw_basc_ciuvis
idw_basc_estrea			= tab_1.tabpage_9.tab_2.tabpage_12.dw_estrea
idw_basc_actfin			= tab_1.tabpage_9.tab_2.tabpage_13.dw_actfin
idw_basc_otrcta			= tab_1.tabpage_9.tab_2.tabpage_14.dw_otrcta
idw_basc_soccom			= tab_1.tabpage_9.tab_2.tabpage_15.dw_soccom
idw_basc_docesc			= tab_1.tabpage_9.tab_2.tabpage_16.dw_docesc

end subroutine

public subroutine of_load_foto (string as_codtra);blob 		lbl_imagen
string	ls_mensaje

selectblob foto_blob
	into :lbl_imagen
	from maestro m
where cod_trabajador = :as_codtra;

if SQLCA.SQLCode = 100 then
	SetNull(lbl_imagen)
end if

if SQLCA.SQlcode = -1 then
	ls_Mensaje = SQLCA.SQlErrText
	ROLLBACK;
	MessageBox('Error al recuperar foto de trabajador', ls_mensaje)
	return
end if

if not Isnull(lbl_imagen) then
	p_foto.SetPicture(lbl_imagen)
else
	setNull(lbl_imagen)
	p_foto.setPicture(lbl_Imagen)
	p_foto.picturename = is_not_imagen
end if
end subroutine

public subroutine of_retrieve_item (long al_row);String ls_cod_trab, ls_flag_estado

ls_cod_trab    = dw_lista.object.cod_trabajador [al_row]
ls_flag_estado = dw_lista.object.flag_estado	  	[al_row]

dw_master.retrieve(ls_cod_trab)
idw_detail_carga.retrieve(ls_cod_trab)
idw_tarjetas.retrieve(ls_cod_trab)
idw_cargos.retrieve(ls_cod_trab)
idw_establecimientos.retrieve(ls_cod_trab)
idw_periodos_laborales.retrieve(ls_cod_trab)
idw_basc_infgen.retrieve(ls_cod_trab)
idw_basc_ciuvis.retrieve(ls_cod_trab)
idw_basc_estrea.retrieve(ls_cod_trab)
idw_basc_actfin.retrieve(ls_cod_trab)
idw_basc_otrcta.retrieve(ls_cod_trab)
idw_basc_soccom.retrieve(ls_cod_trab)
idw_basc_docesc.retrieve(ls_cod_trab)

if dw_master.rowcount() > 0 then
	is_accion = 'fileopen'
	of_load_foto(ls_cod_trab)
end if	

//bloquearlo
dw_master.ii_protect = 0
idw_detail.ii_protect = 0
idw_detail_carga.ii_protect = 0
idw_tarjetas.ii_protect = 0
idw_cargos.ii_protect = 0
idw_establecimientos.ii_protect = 0
idw_basc_infgen.ii_protect = 0
idw_basc_ciuvis.ii_protect = 0
idw_basc_estrea.ii_protect = 0
idw_basc_actfin.ii_protect = 0
idw_basc_otrcta.ii_protect = 0
idw_basc_soccom.ii_protect = 0
idw_basc_docesc.ii_protect = 0
this.TriggerEvent('ue_modify')

dw_master.ResetUpdate()
idw_detail.ResetUpdate()
idw_detail_carga.ResetUpdate()
idw_tarjetas.ResetUpdate()
idw_cargos.ResetUpdate()
idw_establecimientos.ResetUpdate()
idw_basc_infgen.ResetUpdate()
idw_basc_ciuvis.ResetUpdate()
idw_basc_estrea.ResetUpdate()
idw_basc_actfin.ResetUpdate()
idw_basc_otrcta.ResetUpdate()
idw_basc_soccom.ResetUpdate()
idw_basc_docesc.ResetUpdate()

end subroutine

public subroutine of_insert_lista_trab ();Long   ll_row
String ls_apel_paterno,ls_apel_materno,ls_nombre1,ls_nombre2,ls_nombres


/*Nombres*/
ls_apel_paterno = dw_master.object.apel_paterno [dw_master.Getrow()]
ls_apel_materno = dw_master.object.apel_materno [dw_master.Getrow()]
ls_nombre1		 = dw_master.object.nombre1		[dw_master.Getrow()]
ls_nombre2		 = dw_master.object.nombre2		[dw_master.Getrow()]

if Isnull(ls_apel_paterno) or trim(ls_apel_paterno) = '' then ls_apel_paterno = ' '
if Isnull(ls_apel_materno) or trim(ls_apel_materno) = '' then ls_apel_materno = ' '
if Isnull(ls_nombre1) 		or trim(ls_nombre1) 		 = '' then ls_nombre1 		= ' '
if Isnull(ls_nombre2) 		or trim(ls_nombre2) 		 = '' then ls_nombre2 		= ' '

ls_nombres = ls_apel_paterno+' '+ls_apel_materno+' '+ls_nombre1+' '+ls_nombre2


ll_row = dw_lista.InsertRow(0)
dw_lista.object.cod_trabajador [ll_row] = dw_master.object.cod_trabajador [dw_master.Getrow()]
dw_lista.object.nom_trabajador [ll_row] = ls_nombres
dw_lista.object.cod_origen		 [ll_row] = dw_master.object.cod_origen	  [dw_master.Getrow()]
dw_lista.object.flag_estado	 [ll_row] = dw_master.object.flag_estado	  [dw_master.Getrow()]
		
dw_lista.SetSort('cod_origen,nombres')		
dw_lista.Sort()
dw_lista.GroupCalc()
end subroutine

on w_rh030_abc_maestro_personal.create
int iCurrent
call super::create
if this.MenuName = "m_master_simple" then this.MenuID = create m_master_simple
this.st_alerta=create st_alerta
this.rr_1=create rr_1
this.st_ficha1=create st_ficha1
this.pb_ficha1=create pb_ficha1
this.st_rows=create st_rows
this.cbx_activos=create cbx_activos
this.p_foto=create p_foto
this.st_campo=create st_campo
this.dw_3=create dw_3
this.pb_refrescar=create pb_refrescar
this.pb_imprimir=create pb_imprimir
this.st_imprimir=create st_imprimir
this.st_refrescar=create st_refrescar
this.p_2=create p_2
this.dw_lista=create dw_lista
this.tab_1=create tab_1
this.dw_master=create dw_master
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.st_alerta
this.Control[iCurrent+2]=this.rr_1
this.Control[iCurrent+3]=this.st_ficha1
this.Control[iCurrent+4]=this.pb_ficha1
this.Control[iCurrent+5]=this.st_rows
this.Control[iCurrent+6]=this.cbx_activos
this.Control[iCurrent+7]=this.p_foto
this.Control[iCurrent+8]=this.st_campo
this.Control[iCurrent+9]=this.dw_3
this.Control[iCurrent+10]=this.pb_refrescar
this.Control[iCurrent+11]=this.pb_imprimir
this.Control[iCurrent+12]=this.st_imprimir
this.Control[iCurrent+13]=this.st_refrescar
this.Control[iCurrent+14]=this.p_2
this.Control[iCurrent+15]=this.dw_lista
this.Control[iCurrent+16]=this.tab_1
this.Control[iCurrent+17]=this.dw_master
end on

on w_rh030_abc_maestro_personal.destroy
call super::destroy
if IsValid(MenuID) then destroy(MenuID)
destroy(this.st_alerta)
destroy(this.rr_1)
destroy(this.st_ficha1)
destroy(this.pb_ficha1)
destroy(this.st_rows)
destroy(this.cbx_activos)
destroy(this.p_foto)
destroy(this.st_campo)
destroy(this.dw_3)
destroy(this.pb_refrescar)
destroy(this.pb_imprimir)
destroy(this.st_imprimir)
destroy(this.st_refrescar)
destroy(this.p_2)
destroy(this.dw_lista)
destroy(this.tab_1)
destroy(this.dw_master)
end on

event ue_open_pre;call super::ue_open_pre;of_asigna_dws()

dw_lista.SetTransObject(sqlca)

dw_master.SetTransObject(sqlca)  				// Relacionar el dw con la base de datos
idw_detail.SetTransObject(sqlca)
idw_detail_carga.SetTransObject(sqlca)
idw_detail_carga_det.SetTransObject(sqlca)
idw_detail_otros.SetTransObject(sqlca)
idw_tarjetas.SetTransObject(sqlca)
idw_cargos.SetTransObject(sqlca)
idw_rtps.SetTransObject(sqlca)
idw_establecimientos.SetTransObject(sqlca)
idw_periodos_laborales.SetTransObject(sqlca)
idw_basc_infgen.SetTransObject(sqlca)
idw_basc_ciuvis.SetTransObject(sqlca)
idw_basc_estrea.SetTransObject(sqlca)
idw_basc_actfin.SetTransObject(sqlca)
idw_basc_otrcta.SetTransObject(sqlca)
idw_basc_soccom.SetTransObject(sqlca)
idw_basc_docesc.SetTransObject(sqlca)

idw_1 = dw_master              				// asignar dw corriente

dw_master.sharedata(idw_detail)
dw_master.sharedata(idw_basc_infgen)
dw_master.sharedata(idw_rtps)
idw_detail.sharedata(idw_detail_otros)

idw_detail_carga.sharedata(idw_detail_carga_det)

is_col = 'nom_trabajador'
is_tipo = LEFT( dw_lista.Describe(is_col + ".ColType"),1)	
st_campo.text = 'Por : '+ dw_lista.Describe(is_col + "_t.text")

this.event ue_retrieve_lista()

m_master_simple.m_file.m_printer.m_print1.enabled = true
m_master_simple.m_file.m_printer.m_print1.toolbaritemvisible = true
m_master_simple.m_file.m_printer.m_print1.toolbaritemorder = 980

try 
	is_not_imagen = gnvo_app.of_get_parametro("FILE_NOT_IMAGEN", "C:\SIGRE\resources\PNG\noimage.png")
	
catch ( Exception ex )
	gnvo_app.of_catch_Exception(ex, "Error en evento ue_open_pre, no se puede cargar parametros")

end try

end event

event ue_modify;call super::ue_modify;Long   ll_row
String ls_flag_estado

ll_row = dw_master.Getrow()

if ll_row = 0 then return

dw_master.of_protect()
idw_detail.of_protect()
idw_detail_carga.of_protect()
idw_detail_carga_det.of_protect()
idw_detail_otros.of_protect()
idw_tarjetas.of_protect()
idw_cargos.of_protect()
idw_rtps.of_protect()
idw_establecimientos.of_protect()
idw_periodos_laborales.of_protect()
idw_basc_infgen.of_protect()
idw_basc_ciuvis.of_protect()
idw_basc_estrea.of_protect()
idw_basc_actfin.of_protect()
idw_basc_otrcta.of_protect()
idw_basc_soccom.of_protect()
idw_basc_docesc.of_protect()

end event

event ue_update;Boolean 	lbo_ok = TRUE
String 	ls_Cod_trabajador, ls_find
Long		ll_find

dw_master.AcceptText()
idw_detail.AcceptText()
idw_detail_carga.AcceptText()
idw_rtps.AcceptText()
idw_tarjetas.AcceptText()
idw_cargos.AcceptText()
idw_establecimientos.AcceptText()
idw_periodos_laborales.AcceptText()
idw_detail_otros.AcceptText()
idw_basc_infgen.AcceptText()
idw_basc_ciuvis.AcceptText()
idw_basc_estrea.AcceptText()
idw_basc_actfin.AcceptText()
idw_basc_otrcta.AcceptText()
idw_basc_soccom.AcceptText()

THIS.EVENT ue_update_pre()
IF ib_update_check = FALSE THEN
	ROLLBACK ;
	RETURN
END IF	

if ib_log then
	dw_master.of_create_log()
	idw_detail_carga.of_create_log()
	idw_tarjetas.of_create_log()
	idw_cargos.of_create_log()
	idw_establecimientos.of_create_log()
	idw_periodos_laborales.of_create_log()
	idw_basc_ciuvis.of_create_log()
	idw_basc_estrea.of_create_log()
	idw_basc_actfin.of_create_log()
	idw_basc_otrcta.of_create_log()
	idw_basc_soccom.of_create_log()
end if


IF	(dw_master.ii_update = 1 or idw_detail.ii_update = 1 or &
	 idw_rtps.ii_update = 1  or idw_detail_otros.ii_update = 1 or idw_basc_infgen.ii_update = 1) AND lbo_ok = TRUE THEN
	 
	IF dw_master.Update(true, false) = -1 then		// Grabacion del Master
		lbo_ok = FALSE
    	Rollback ;
		messagebox("Error en Grabacion Master","Se ha procedido al rollback",exclamation!)
	END IF
	
END IF

IF idw_detail_carga.ii_update = 1 THEN
	IF idw_detail_carga.Update(true, false) = -1 then		// Grabacion del detalle
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion Detail de Carga Familiar","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_tarjetas.ii_update = 1 THEN
	IF idw_tarjetas.Update(true, false) = -1 then		// Grabacion del detalle de tarjetas
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion Detalle de Tarjetas","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_cargos.ii_update = 1 THEN
	IF idw_cargos.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion Detalle de Cargos","Se ha procedido al rollback",exclamation!)
	END IF
END IF 

IF idw_establecimientos.ii_update = 1 THEN
	IF idw_establecimientos.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Movimientos Por Establecimiento","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_periodos_laborales.ii_update = 1 THEN
	IF idw_periodos_laborales.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Periodos laborales","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_basc_ciuvis.ii_update = 1 THEN
	IF idw_basc_ciuvis.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Ciudades Visitadas","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_basc_estrea.ii_update = 1 THEN
	IF idw_basc_estrea.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Estudios Realizados","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_basc_actfin.ii_update = 1 THEN
	IF idw_basc_actfin.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Activos Financieros","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_basc_otrcta.ii_update = 1 THEN
	IF idw_basc_otrcta.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Otras Cuentas Bancarias","Se ha procedido al rollback",exclamation!)
	END IF
END IF

IF idw_basc_soccom.ii_update = 1 THEN
	IF idw_basc_soccom.Update(true, false) = -1 then		// Grabacion del detalle de Cargos
		lbo_ok = FALSE
      Rollback ;
		messagebox("Error en Grabacion de Sociedades Comerciales","Se ha procedido al rollback",exclamation!)
	END IF
END IF

if ib_log then
	if lbo_ok then
		lbo_ok = dw_master.of_save_log()		
		lbo_ok = idw_detail_carga.of_save_log()
		lbo_ok = idw_tarjetas.of_save_log()
		lbo_ok = idw_cargos.of_save_log()
		lbo_ok = idw_establecimientos.of_save_log()
		lbo_ok = idw_periodos_laborales.of_save_log()
		lbo_ok = idw_basc_ciuvis.of_save_log()
		lbo_ok = idw_basc_estrea.of_save_log()
		lbo_ok = idw_basc_actfin.of_save_log()
		lbo_ok = idw_basc_otrcta.of_save_log()
		lbo_ok = idw_basc_soccom.of_save_log()
	end if
end if

IF lbo_ok THEN
	//Aplico los cambios
	COMMIT using SQLCA;
	
	//Quito las actualizaciones
	dw_master.ResetUpdate( )
	idw_detail.ResetUpdate( )
	idw_rtps.ResetUpdate( )
	idw_detail_otros.ResetUpdate( )
	idw_detail_carga.ResetUpdate( )
	idw_tarjetas.ResetUpdate( )
	idw_cargos.ResetUpdate( )
	idw_establecimientos.ResetUpdate( )
	idw_periodos_laborales.ResetUpdate( )
	idw_basc_infgen.ResetUpdate( )
	idw_basc_ciuvis.ResetUpdate( )
	idw_basc_estrea.ResetUpdate( )
	idw_basc_actfin.ResetUpdate( )
	idw_basc_otrcta.ResetUpdate( )
	idw_basc_soccom.ResetUpdate( )

	
	dw_master.ii_update = 0
	idw_detail.ii_update = 0
	idw_rtps.ii_update = 0
	idw_detail_otros.ii_update = 0
	idw_detail_carga.ii_update = 0
	idw_tarjetas.ii_update = 0
	idw_cargos.ii_update = 0
	idw_establecimientos.ii_update = 0
	idw_periodos_laborales.ii_update = 0
	idw_basc_infgen.ii_update = 0
	idw_basc_ciuvis.ii_update = 0
	idw_basc_estrea.ii_update = 0
	idw_basc_actfin.ii_update = 0
	idw_basc_otrcta.ii_update = 0
	idw_basc_soccom.ii_update = 0
	
	if is_accion = 'new' then
		//inserta registro en la lista
		//wf_insert_lista_trab()
		if dw_master.getRow() > 0 then
			ls_cod_trabajador = dw_master.object.cod_trabajador[dw_master.getRow()]
		else
			SetNull(ls_cod_trabajador)
		end if
		
		event ue_retrieve_lista()
		
		if dw_lista.RowCount() > 0 then
			if not IsNull(ls_cod_trabajador) and trim(ls_cod_trabajador)  <> '' then
				ls_find = "cod_trabajador='" + ls_cod_trabajador + "'"
				
				ll_find = dw_lista.find(ls_find, 1, dw_lista.RowCount())
				
				if ll_find = 0 then ll_find = 1
				
				dw_lista.setRow(ll_find)
				dw_lista.SelectRow(0, false)
				dw_lista.SelectRow(ll_find, true)
					
				of_retrieve_item(ll_find)
					
			end if
		end if
	else
		of_retrieve_item(dw_lista.getRow())
	end if
	
	
	is_accion = 'fileopen'
	
	f_mensaje("Grabación de actualizaciones realizada satisfactoriamente", "")
	
END IF

end event

event ue_update_pre;call super::ue_update_pre;//verifcar nuevo registro
Long   ll_inicio,ll_row_master
String ls_cod_trabajador, ls_origen, ls_tipo_trabaj, ls_cod_afp
dwItemStatus ldis_status

//*Codigo de Trabajador  (Genera Codigo de Trabajador) *//
nvo_numeradores lnvo_numeradores
lnvo_numeradores = CREATE nvo_numeradores

ll_row_master = dw_master.Getrow()

ib_update_check = False

//Verificación de Data en Detalle de Documento
IF gnvo_app.of_row_Processing( dw_master ) <> true then	
	dw_master.setFocus( )
	return
END IF


//Verificación de Data en Detalle de Documento
IF gnvo_app.of_row_Processing( idw_detail ) <> true then	
	idw_detail.SetFocus( )
	return
END IF

//Verificación de Data en Detalle de Documento
IF gnvo_app.of_row_Processing( idw_detail_otros ) <> true then	
	idw_detail_otros.SetFocus( )
	return
END IF

//Verificación de Data Tarjetas Documento
IF gnvo_app.of_row_Processing( idw_tarjetas ) <> true then	
	idw_tarjetas.SetFocus( )
	return
END IF

//Verificación de Data Tarjetas Documento
IF gnvo_app.of_row_Processing( idw_rtps ) <> true then	
	idw_rtps.SetFocus( )
	return
END IF

//Verificación de Data en Detalle de Documento
IF gnvo_app.of_row_Processing( idw_cargos ) <> true then
	idw_cargos.SetFocus()
	return
END IF

//Verificación de Data en Detalle de Ciudades Visitadas
IF gnvo_app.of_row_Processing( idw_basc_ciuvis ) <> true then
	idw_basc_ciuvis.SetFocus()
	return
END IF

//Verificación de Data en Detalle de Estudios Realizados
IF gnvo_app.of_row_Processing( idw_basc_estrea ) <> true then
	idw_basc_estrea.SetFocus()
	return
END IF
//Verificación de Data en Detalle de Activos Financieros
IF gnvo_app.of_row_Processing( idw_basc_actfin ) <> true then
	idw_basc_actfin.SetFocus()
	return
END IF
//Verificación de Data en Detalle de Otras Cuentas Bancarias
IF gnvo_app.of_row_Processing( idw_basc_otrcta ) <> true then
	idw_basc_otrcta.SetFocus()
	return
END IF
//Verificación de Data en Detalle de Sociedades Comerciales
IF gnvo_app.of_row_Processing( idw_basc_soccom ) <> true then
	idw_basc_soccom.SetFocus()
	return
END IF

//Validar opciones, 1).- AFP
ls_cod_afp 		= idw_detail.object.cod_afp [idw_detail.GetRow()]
ls_tipo_trabaj = dw_master.object.tipo_trabajador [1]

//Valido para tripulantes, no debe tener el cod_afp en nulo
//if ls_tipo_trabaj = gnvo_app.rrhhparam.is_tipo_tri then
//	if IsNull(ls_cod_afp) or trim(ls_cod_afp) = '' then
//		MessageBox('Error', 'Debe Especificar si el TRIPULANTE pertenece al REP o a alguna AFP, no esta permitido que este campo este vacío o nul, por favor corrija!')
//		tab_1.SelectedTab = 1
//		idw_detail.SetFocus( )
//		return
//	end if
//end if

if Not IsNull(ls_cod_afp) and trim(ls_Cod_afp) <> '' then
	if idw_detail.object.flag_comision_afp [idw_detail.GetRow()] = '0' then
		MessageBox('Error', 'Debe Especificar el flag de Comision de la AFP, por favor confirmar!')
		tab_1.SelectedTab = 1
		idw_detail.SetFocus( )
		idw_detail.setColumn( "flag_comision_afp" )
		return
	end if
else	
	idw_detail.object.flag_comision_afp [idw_detail.GetRow()] = '0'
	idw_detail.ii_update = 1
	dw_master.ii_update 	= 1
end if



//numerador de subsidio
if is_accion = 'new' then
	SetNull(ls_cod_trabajador)
	ls_origen = dw_master.object.cod_origen [dw_master.GetRow()]
		
	IF	lnvo_numeradores.uf_num_maestro(ls_origen,ls_cod_trabajador) = FALSE THEN return

	dw_master.object.cod_trabajador [ll_row_master] = ls_cod_trabajador
end if

ls_cod_trabajador = dw_master.object.cod_trabajador [ll_row_master]


For ll_inicio = 1 to idw_detail_carga.Rowcount()
	 ldis_status = idw_detail_carga.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_detail_carga.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next

For ll_inicio = 1 to idw_tarjetas.Rowcount()
	 ldis_status = idw_tarjetas.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_tarjetas.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	

For ll_inicio = 1 to idw_cargos.Rowcount()
	 ldis_status = idw_cargos.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_cargos.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next

For ll_inicio = 1 to idw_establecimientos.Rowcount()
	 ldis_status = idw_establecimientos.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_establecimientos.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next

For ll_inicio = 1 to idw_periodos_laborales.Rowcount()
	 ldis_status = idw_periodos_laborales.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_periodos_laborales.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	

For ll_inicio = 1 to idw_basc_ciuvis.Rowcount()
	 ldis_status = idw_basc_ciuvis.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_basc_ciuvis.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	

For ll_inicio = 1 to idw_basc_estrea.Rowcount()
	 ldis_status = idw_basc_estrea.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_basc_estrea.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	
For ll_inicio = 1 to idw_basc_actfin.Rowcount()
	 ldis_status = idw_basc_actfin.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_basc_actfin.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	
For ll_inicio = 1 to idw_basc_otrcta.Rowcount()
	 ldis_status = idw_basc_otrcta.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_basc_otrcta.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	
For ll_inicio = 1 to idw_basc_soccom.Rowcount()
	 ldis_status = idw_basc_soccom.GetItemStatus(ll_inicio,0,Primary!)	
	 
	 IF ldis_status = NewModified! THEN
		 idw_basc_soccom.object.cod_trabajador [ll_inicio] = ls_cod_trabajador
	 END IF	 
Next	

ib_update_check = true
end event

event ue_insert;call super::ue_insert;Long   ll_row,ll_row_master
String ls_cod_area



choose case idw_1
		 case dw_master
				is_accion = 'new'
				TriggerEvent('ue_update_request')
				if ib_update_check = false then return
				dw_master.Reset()
				idw_detail_carga.Reset()
				idw_tarjetas.reset( )
				idw_cargos.reset( )
				idw_establecimientos.reset( )
				idw_periodos_laborales.Reset()
				idw_basc_ciuvis.Reset()
				idw_basc_estrea.Reset()
				idw_basc_actfin.Reset()
				idw_basc_otrcta.Reset()
				idw_basc_soccom.Reset()
				idw_basc_docesc.Reset()
				
		 case idw_detail_carga
				ll_row_master = dw_master.Getrow()
				if ll_row_master = 0 then
					Messagebox('Aviso','No Puede Insertar Carga Familiar si no ha ingresado Trabajador')
					Return 					
				end if
				
		 case idw_detail_carga_det
				ll_row_master = dw_master.Getrow()
				if ll_row_master = 0 then
				Messagebox('Aviso','Solo Inserte En la Cabecera de Carga')
				Return					
				end if
				
		 case idw_tarjetas
				ll_row_master = dw_master.Getrow()
				if ll_row_master = 0 then
					Messagebox('Aviso','No Puede Insertar Tarjeta de Proximidad si no ha ingresado Trabajador')
					Return 					
				end if
				
		 case idw_cargos
			
				ll_row_master = dw_master.Getrow()
				
				
				if ll_row_master = 0 then
					Messagebox('Aviso','No Puede Insertar Cargos si no ha ingresado Trabajador')
					Return 					
				end if
				
				ls_cod_area = dw_master.object.cod_area[ll_row_master]
				
				if Isnull(ls_cod_area) or trim(ls_cod_area) = ''  then
					Messagebox('Aviso','No Puede Insertar Cargos si no ha ingresado el Area del trabajador')
					Return 					
				end if
				
		case idw_establecimientos			
				ll_row_master = dw_master.Getrow()						
				if ll_row_master = 0 then
					Messagebox('Aviso','No Puede Insertar Establecimientos si no ha ingresado Trabajador')
					Return 					
				end if
				
		case idw_periodos_laborales			
				ll_row_master = dw_master.Getrow()							
				if ll_row_master = 0 then
					Messagebox('Aviso','No Puede Insertar El Periodo Labora si no ha ingresado Trabajador')
					Return 					
				end if
			
		case idw_basc_ciuvis, idw_basc_estrea, idw_basc_actfin, idw_basc_otrcta, idw_basc_soccom, idw_basc_docesc
				ll_row_master = dw_master.Getrow()							
				if ll_row_master = 0 then
					Messagebox('Aviso','No Puede Insertar Datos BASC si no ha ingresado Trabajador')
					Return 					
				end if
				
		case else
				Messagebox('Aviso','Solo Inserte En la Cabecera y Carga Familiar')
				Return 
end choose











ll_row = idw_1.Event ue_insert()

IF ll_row <> -1 THEN THIS.EVENT ue_insert_pos(ll_row)


end event

event ue_update_request;call super::ue_update_request;Integer li_msg_result

// Revisa si hay actualizaciones pendientes y pregunta si se quiere actualizar
IF (	dw_master.ii_update = 1 OR &
		idw_detail_carga.ii_update = 1 OR &
		idw_tarjetas.ii_update = 1 OR &
		idw_cargos.ii_update = 1 OR &
		idw_basc_ciuvis.ii_update = 1 or &
		idw_basc_estrea.ii_update = 1 or idw_basc_actfin.ii_update = 1 or idw_basc_otrcta.ii_update = 1 or idw_basc_soccom.ii_update = 1 ) THEN
		
	li_msg_result = MessageBox("Actualizaciones Pendientes", "Grabamos", Question!, YesNo!, 1)
	IF li_msg_result = 1 THEN
 		this.TriggerEvent("ue_update")
	ELSE
		dw_master.ii_update = 0
		idw_detail_carga.ii_update = 0
		idw_tarjetas.ii_update = 0
		idw_cargos.ii_update = 0
		idw_establecimientos.ii_update = 0
		idw_basc_ciuvis.ii_update = 0
		idw_basc_estrea.ii_update = 0
		idw_basc_actfin.ii_update = 0
		idw_basc_otrcta.ii_update = 0
		idw_basc_soccom.ii_update = 0
		ib_update_check = true
	END IF
END IF

end event

event ue_delete;Long  ll_row


IF Not( (idw_1 = idw_detail_carga) or &
		  (idw_1 = idw_tarjetas) or &
		  (idw_1 = idw_cargos) or &
		  (idw_1 = idw_establecimientos) or &
		  (idw_1 = idw_periodos_laborales) or &
		  (idw_1 = idw_basc_ciuvis) or (idw_1 = idw_basc_estrea) or (idw_1 = idw_basc_actfin) or (idw_1 = idw_basc_otrcta) or (idw_1 = idw_basc_soccom) ) THEN
		  
	Messagebox('Aviso','No Puede Eliminar Trabajador , Solo Desactivarlo')
	
	Return
END IF

ll_row = idw_1.Event ue_delete()

IF ll_row = 1 THEN
	THIS.Event ue_delete_list()
	THIS.Event ue_delete_pos(ll_row)
END IF

end event

event ue_print;call super::ue_print;String  ls_cod_trabajador
Str_cns_pop lstr_cns_pop
//
////Verificacion de Nro de Orden
ls_cod_trabajador = dw_master.GetItemString(1,'cod_trabajador')

//
IF is_accion = 'new' THEN RETURN

lstr_cns_pop.arg[1] = ls_cod_trabajador

//ficha de personal
OpenSheetWithParm(w_rh704_ficha_personal, lstr_cns_pop, this, 2, Layered!)
end event

event resize;call super::resize;int li_VerticalMargin, li_horizontalMargin
decimal ldc_distancia

li_VerticalMargin = 10;
li_horizontalMargin = 10;

//Muevo el marco de botones
rr_1.y 				= newheight - rr_1.height - li_VerticalMargin
rr_1.width 			= newwidth - rr_1.x - li_horizontalMargin

//Calculo la equidistancia del boton y la etiqueta con la parte superior e interior
//Boton Imprimir
pb_imprimir.y 		= rr_1.y + (rr_1.height - (pb_imprimir.height + st_imprimir.height)) / 2
st_imprimir.y 		= pb_imprimir.y + pb_imprimir.height

//Boton refrescar
pb_refrescar.y 	= rr_1.y + (rr_1.height - (pb_refrescar.height + st_refrescar.height)) / 2
st_refrescar.y 	= pb_refrescar.y + pb_refrescar.height

//Boton ficha de Elección de Sistema de Pensiones
pb_ficha1.y 		= rr_1.y + (rr_1.height - (pb_ficha1.height + st_ficha1.height)) / 2
st_ficha1.y 		= pb_ficha1.y + pb_ficha1.height


tab_1.width  		= newwidth  - tab_1.x - li_VerticalMargin
tab_1.height  		= rr_1.y - li_HorizontalMargin - tab_1.y

//La Lista
dw_lista.height  = newheight - li_VerticalMargin - dw_lista.y


//Asigno los datawindows para poder trabajar con ellos
of_asigna_dws()

idw_detail.width  				= tab_1.tabpage_1.width  - idw_detail.x - li_VerticalMargin
idw_detail.height 				= tab_1.tabpage_1.height - idw_detail.y - li_horizontalMargin

idw_rtps.width  					= tab_1.tabpage_6.width  - idw_rtps.x - li_horizontalMargin
idw_rtps.height 					= tab_1.tabpage_6.height - idw_rtps.y - li_VerticalMargin

idw_detail_carga.width  		= tab_1.tabpage_2.width  - idw_detail_carga.x - li_horizontalMargin
idw_detail_carga_det.width  	= tab_1.tabpage_2.width  - idw_detail_carga_det.x - li_horizontalMargin
idw_detail_carga_det.height 	= tab_1.tabpage_2.height - idw_detail_carga_det.y - li_VerticalMargin

idw_detail_otros.width  		= tab_1.tabpage_3.width  - idw_detail_otros.x - li_horizontalMargin
idw_detail_otros.height 		= tab_1.tabpage_3.height - idw_detail_otros.y - li_VerticalMargin

idw_tarjetas.width  				= tab_1.tabpage_4.width  - idw_tarjetas.x - li_horizontalMargin
idw_tarjetas.height 				= tab_1.tabpage_4.height - idw_tarjetas.y - li_VerticalMargin

idw_cargos.width  				= tab_1.tabpage_5.width  - idw_cargos.x - li_horizontalMargin
idw_cargos.height 				= tab_1.tabpage_5.height - idw_cargos.y - li_VerticalMargin

idw_establecimientos.width  	= tab_1.tabpage_7.width  - idw_establecimientos.x - li_horizontalMargin
idw_establecimientos.height 	= tab_1.tabpage_7.height - idw_establecimientos.y - li_VerticalMargin

idw_periodos_laborales.width  = tab_1.tabpage_8.width  - idw_periodos_laborales.x - li_horizontalMargin
idw_periodos_laborales.height = tab_1.tabpage_8.height - idw_periodos_laborales.y - li_VerticalMargin

//basc
tab_1.tabpage_9.tab_2.width 	= tab_1.tabpage_9.width - tab_1.tabpage_9.tab_2.x
tab_1.tabpage_9.tab_2.height 	= tab_1.tabpage_9.height - tab_1.tabpage_9.tab_2.y

idw_basc_infgen.width			= tab_1.tabpage_9.tab_2.tabpage_10.width - idw_basc_infgen.x - 20
idw_basc_infgen.height			= tab_1.tabpage_9.tab_2.tabpage_10.height - idw_basc_infgen.y - 20

idw_basc_ciuvis.width			= tab_1.tabpage_9.tab_2.tabpage_11.width - idw_basc_ciuvis.x - 20
idw_basc_ciuvis.height			= tab_1.tabpage_9.tab_2.tabpage_11.height - idw_basc_ciuvis.y - 20

idw_basc_estrea.width			= tab_1.tabpage_9.tab_2.tabpage_12.width - idw_basc_estrea.x - 20
idw_basc_estrea.height			= tab_1.tabpage_9.tab_2.tabpage_12.height - idw_basc_estrea.y - 20

idw_basc_actfin.width			= tab_1.tabpage_9.tab_2.tabpage_13.width - idw_basc_actfin.x - 20
idw_basc_actfin.height			= tab_1.tabpage_9.tab_2.tabpage_13.height - idw_basc_actfin.y - 20

idw_basc_otrcta.width			= tab_1.tabpage_9.tab_2.tabpage_14.width - idw_basc_otrcta.x - 20
idw_basc_otrcta.height			= tab_1.tabpage_9.tab_2.tabpage_14.height - idw_basc_otrcta.y - 20

idw_basc_soccom.width			= tab_1.tabpage_9.tab_2.tabpage_15.width - idw_basc_soccom.x - 20
idw_basc_soccom.height			= tab_1.tabpage_9.tab_2.tabpage_15.height - idw_basc_soccom.y - 20

idw_basc_docesc.width			= tab_1.tabpage_9.tab_2.tabpage_16.width - idw_basc_docesc.x - 20
idw_basc_docesc.height			= tab_1.tabpage_9.tab_2.tabpage_16.height - idw_basc_docesc.y - 20

end event

type st_alerta from statictext within w_rh030_abc_maestro_personal
boolean visible = false
integer x = 197
integer y = 12
integer width = 704
integer height = 64
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 16777215
long backcolor = 255
string text = "Error en busqueda"
alignment alignment = center!
boolean focusrectangle = false
end type

type rr_1 from roundrectangle within w_rh030_abc_maestro_personal
integer linethickness = 4
long fillcolor = 8421504
integer x = 1509
integer y = 2164
integer width = 1806
integer height = 352
integer cornerheight = 40
integer cornerwidth = 46
end type

type st_ficha1 from statictext within w_rh030_abc_maestro_personal
integer x = 2139
integer y = 2400
integer width = 224
integer height = 116
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 8421504
string text = "Ficha Elección"
alignment alignment = center!
boolean focusrectangle = false
end type

type pb_ficha1 from picturebutton within w_rh030_abc_maestro_personal
integer x = 2126
integer y = 2192
integer width = 238
integer height = 204
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string picturename = "C:\SIGRE\resources\JPG\confirming3.jpg"
alignment htextalign = left!
string powertiptext = "Ficha Elección de Sistema de Pensiones"
end type

event clicked;Parent.TriggerEvent('ue_print_ficha_eleccion')
end event

type st_rows from statictext within w_rh030_abc_maestro_personal
integer x = 1253
integer y = 112
integer width = 233
integer height = 64
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean italic = true
long textcolor = 16777215
long backcolor = 8388608
alignment alignment = center!
boolean focusrectangle = false
end type

type cbx_activos from checkbox within w_rh030_abc_maestro_personal
integer x = 933
integer y = 16
integer width = 539
integer height = 76
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Mostrar solo activos"
end type

event clicked;parent.event ue_retrieve_lista()


end event

type p_foto from picture within w_rh030_abc_maestro_personal
integer x = 4393
integer y = 56
integer width = 617
integer height = 548
boolean border = true
boolean focusrectangle = false
string powertiptext = "Foto del trabajador"
end type

type st_campo from statictext within w_rh030_abc_maestro_personal
integer x = 192
integer y = 112
integer width = 1038
integer height = 64
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean italic = true
long textcolor = 33554432
long backcolor = 67108864
string text = "Por Nombres"
boolean focusrectangle = false
end type

type dw_3 from datawindow within w_rh030_abc_maestro_personal
event ue_tecla pbm_dwnkey
event dw_enter pbm_dwnprocessenter
integer x = 192
integer y = 188
integer width = 1298
integer height = 80
integer taborder = 30
boolean bringtotop = true
string title = "none"
string dataobject = "d_campo"
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event ue_tecla;Long ll_row

if keydown(keyuparrow!) then		// Anterior
	dw_lista.scrollpriorRow()
elseif keydown(keydownarrow!) then	// Siguiente
	dw_lista.scrollnextrow()	
end if

ll_row = dw_3.Getrow()

Return 1
end event

event dw_enter;dw_lista.triggerevent(doubleclicked!)
return 1
end event

event constructor;Long ll_reg

ll_reg = this.insertrow(0)
end event

event editchanged;// Si el usuario comienza a editar una columna, entonces reordenar el dw superior segun
// la columna que se este editando, y luego hacer scroll hasta el valor que se ha ingresado para 
// esta columna, tecla por tecla.

Integer li_longitud
string ls_item, ls_ordenado_por, ls_comando
Long ll_fila

SetPointer(hourglass!)

if TRIM( is_col) <> '' THEN
	ls_item = upper( this.GetText())

	li_longitud = len( ls_item)
	if li_longitud > 0 then		// si ha escrito algo
	//	ls_comando = "UPPER(LEFT(" + is_col +"," + String(li_longitud) + "))='" + ls_item + "'"
	
		IF Upper( is_tipo) = 'N' OR UPPER( is_tipo) = 'D' then
			ls_comando = is_col + "=" + ls_item 
		ELSEIF UPPER( is_tipo) = 'C' then
		   //ls_comando = "POS(UPPER(" + is_col +"), '" + ls_item + "') > 0"
			ls_comando = "LEFT(UPPER(" + is_col + "), LEN(TRIM('" + ls_item + "')))='" + ls_item + "'"
		END IF
	
		ll_fila = dw_lista.find(ls_comando, 1, dw_lista.rowcount())
		
		IF ll_fila > 0 THEN		// la busqueda resulto exitosa
		
			st_alerta.visible = false
			
			dw_lista.selectrow(0, FALSE)
			dw_lista.selectrow(ll_fila, TRUE)
			dw_lista.scrolltorow(ll_fila)
			dw_3.Setfocus()
			
		elseif ll_fila = 0 then
			
			st_alerta.visible = true
			
		elseif ll_fila = -5 then
			
			st_alerta.visible = false
			
			MessageBox('Error', 'Error en argumento de busqueda: ' + ls_comando + ', por favor verifique!', StopSign!)
			return
			
		END IF
	End if	
end if	
SetPointer(arrow!)
end event

type pb_refrescar from picturebutton within w_rh030_abc_maestro_personal
integer x = 1618
integer y = 2192
integer width = 238
integer height = 204
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string picturename = "C:\SIGRE\resources\Jpg\gears2.JPG"
alignment htextalign = left!
end type

event clicked;parent.event ue_retrieve_lista()
end event

type pb_imprimir from picturebutton within w_rh030_abc_maestro_personal
integer x = 1874
integer y = 2192
integer width = 238
integer height = 204
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string picturename = "C:\SIGRE\resources\Jpg\print.jpg"
alignment htextalign = left!
end type

event clicked;Parent.TriggerEvent('ue_print')
end event

type st_imprimir from statictext within w_rh030_abc_maestro_personal
integer x = 1874
integer y = 2400
integer width = 238
integer height = 116
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 8421504
string text = "Ficha Personal"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_refrescar from statictext within w_rh030_abc_maestro_personal
integer x = 1618
integer y = 2392
integer width = 238
integer height = 116
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 8388608
long backcolor = 8421504
string text = "Refrescar"
alignment alignment = center!
boolean focusrectangle = false
end type

type p_2 from picture within w_rh030_abc_maestro_personal
integer y = 12
integer width = 165
integer height = 236
string picturename = "C:\SIGRE\resources\Gif\toolbtn_people.gif"
boolean focusrectangle = false
end type

type dw_lista from u_dw_abc within w_rh030_abc_maestro_personal
integer y = 284
integer width = 1490
integer height = 1812
integer taborder = 30
string dataobject = "d_abc_lista_trabajadores_tbl"
end type

event constructor;call super::constructor;is_mastdet = 'M'		// 'm' = master sin detalle (default), 'd' =  detalle,
                       	// 'md' = master con detalle, 'dd' = detalle con detalle a la vez
is_dwform = 'tabular'	



ii_ck[1] = 1				// columnas de lectrua de este dw


idw_mst = dw_lista

end event

event rowfocuschanged;//Override
if is_action = 'new' or dw_master.ii_update = 1 then
	if MessageBox('Aviso', 'Existen cambios por realizar, desea continuar?. ' &
								+ 'Si lo hace perderá todos los cambios', &
								Information!, YesNo!, 2) = 2 then return -1
end if

This.SelectRow(0, False)
This.SelectRow(currentrow, True)

This.Setrow(currentrow)

of_retrieve_item(currentrow)
end event

event doubleclicked;//Overriding
Integer li_pos, li_col, j
String  ls_col , ls_report, ls_texto


IF is_dwform = 'tabular' THEN
	THIS.Event ue_column_sort()
ELSE
	IF row = 0 THEN RETURN
	il_row = row                    // fila corriente
	THIS.SetRow(row)
	THIS.Event ue_output(row)
END IF

if row = 0 and right(lower(dwo.name), 2) = '_t' then
	ls_col = lower(dwo.name)
	
	ls_col = left(ls_col, len(ls_col) - 2)
	
	if this.Describe(is_col + ".ColType") <> '!' then
		
		is_col = ls_col
		
		is_tipo = LEFT( this.Describe(is_col + ".ColType"),1)	
		
		ls_texto = this.Describe(is_col + "_t.text")
	
	
		st_campo.text = "Por " + ls_texto
		
		dw_3.reset()
		dw_3.InsertRow(0)
		dw_3.SetFocus()
		
		this.setRow(row)
		this.scrolltoRow(row)
	end if

end if
end event

type tab_1 from tab within w_rh030_abc_maestro_personal
integer x = 1509
integer y = 876
integer width = 4503
integer height = 1284
integer taborder = 10
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 79741120
boolean raggedright = true
boolean focusonbuttondown = true
boolean boldselectedtext = true
integer selectedtab = 1
tabpage_1 tabpage_1
tabpage_6 tabpage_6
tabpage_2 tabpage_2
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_5 tabpage_5
tabpage_7 tabpage_7
tabpage_8 tabpage_8
tabpage_9 tabpage_9
end type

on tab_1.create
this.tabpage_1=create tabpage_1
this.tabpage_6=create tabpage_6
this.tabpage_2=create tabpage_2
this.tabpage_3=create tabpage_3
this.tabpage_4=create tabpage_4
this.tabpage_5=create tabpage_5
this.tabpage_7=create tabpage_7
this.tabpage_8=create tabpage_8
this.tabpage_9=create tabpage_9
this.Control[]={this.tabpage_1,&
this.tabpage_6,&
this.tabpage_2,&
this.tabpage_3,&
this.tabpage_4,&
this.tabpage_5,&
this.tabpage_7,&
this.tabpage_8,&
this.tabpage_9}
end on

on tab_1.destroy
destroy(this.tabpage_1)
destroy(this.tabpage_6)
destroy(this.tabpage_2)
destroy(this.tabpage_3)
destroy(this.tabpage_4)
destroy(this.tabpage_5)
destroy(this.tabpage_7)
destroy(this.tabpage_8)
destroy(this.tabpage_9)
end on

type tabpage_1 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Datos Personales"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
string picturename = "Picture!"
long picturemaskcolor = 536870912
shl_3 shl_3
shl_1 shl_1
dw_detail dw_detail
end type

on tabpage_1.create
this.shl_3=create shl_3
this.shl_1=create shl_1
this.dw_detail=create dw_detail
this.Control[]={this.shl_3,&
this.shl_1,&
this.dw_detail}
end on

on tabpage_1.destroy
destroy(this.shl_3)
destroy(this.shl_1)
destroy(this.dw_detail)
end on

type shl_3 from statichyperlink within tabpage_1
integer x = 2930
integer y = 172
integer width = 119
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean underline = true
string pointer = "HyperLink!"
long textcolor = 134217856
long backcolor = 134217728
string text = ">>>"
alignment alignment = center!
boolean focusrectangle = false
string url = "https://www2.sbs.gob.pe/afiliados/paginas/Consulta.aspx"
end type

type shl_1 from statichyperlink within tabpage_1
integer x = 2930
integer y = 924
integer width = 119
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
boolean underline = true
string pointer = "HyperLink!"
long textcolor = 134217856
long backcolor = 134217728
string text = ">>>"
alignment alignment = center!
boolean focusrectangle = false
string url = "http://ww4.essalud.gob.pe:7777/acredita/"
end type

type dw_detail from u_dw_abc within tabpage_1
integer width = 3579
integer height = 1152
integer taborder = 20
string dataobject = "d_abc_maestro_personal_det_tbl"
borderstyle borderstyle = styleraised!
end type

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                       	// 'md' = master con detalle, 'dd' = detalle con detalle a la vez



ii_ck[1] = 1				// columnas de lectrua de este dw



idw_mst = dw_master

end event

event itemchanged;call super::itemchanged;String 	ls_codigo, ls_nombre, ls_mensaje
Decimal	ldc_years
Date		ld_fec_nacimiento

this.Accepttext()

choose case dwo.name
	case 'fec_nacimiento'
		ld_fec_nacimiento = Date(data)
		
		select (MONTHS_BETWEEN(sysdate, :ld_fec_nacimiento) / 12)
		  into :ldc_years
		from dual;
		
		if SQLCA.SQLCode < 0 then
			ls_mensaje = SQLCA.SQLErrText
			this.object.fec_nacimiento		[row] = gnvo_app.id_null
			Messagebox('Error', 'Error al calcular la cantidad de años. Mensaje: ' + ls_mensaje, STopSign!)
			Return 1
		end if
		
		if ldc_years < 18 then
			ls_mensaje = SQLCA.SQLErrText
			this.object.fec_nacimiento		[row] = gnvo_app.id_null
			Messagebox('Error', 'No puede registrar personal Menor de 18 años, por favor corrija!', STopSign!)
			Return 1
		end if
		
		if ldc_years > 100 then
			ls_mensaje = SQLCA.SQLErrText
			this.object.fec_nacimiento		[row] = gnvo_app.id_null
			Messagebox('Error', 'No puede registrar personal mayor a 100 años, por favor corrija!', STopSign!)
			Return 1
		end if
		
		
	case 'situa_trabaj'
		select desc_sit_trab
			into :ls_nombre
		  from situacion_trabajador
		 where situa_trabaj 	= :data;
				  
		if sqlca.sqlcode = 100 then
			this.object.situa_trabaj		[row] = gnvo_app.is_null
			this.object.desc_situa_trabaj	[row] = gnvo_app.is_null
			Messagebox(this.title, 'Situación de Trabajador no existe o no esta activo, por favor verifique!')
			Return 1
		end if
		
		this.object.desc_situa_trabaj	[row] = ls_nombre

	case 'grupo_trabaj'
		select desc_grupo_Trabaj
			into :ls_nombre
		  from rrhh_grupo_trabajador
		 where grupo_trabaj 	= :data
		   and flag_estado = '1';
				  
		if sqlca.sqlcode = 100 then
			Messagebox("Error", 'Grupo de Trabajador ' + data + ' no existe o no esta activo, por favor verifique!')
			this.object.grupo_trabaj		[row] = gnvo_app.is_null
			this.object.desc_grupo_trabaj	[row] = gnvo_app.is_null
			
			Return 1
		end if
		
		this.object.desc_grupo_trabaj	[row] = ls_nombre
		
		
	case 'cod_afp'
		if not isNull(data) and trim(data) <> '' then
			select desc_afp
				into :ls_nombre
			  from admin_afp
			 where cod_afp 	= :data
				and flag_estado	= '1' ;
					  
			if sqlca.sqlcode = 100 then
				this.object.cod_afp	[row] = gnvo_app.is_null
				this.object.desc_afp	[row] = gnvo_app.is_null
				Messagebox(this.title, 'Código de Moneda no existe o no esta activo, por favor verifique!')
				Return 1
			end if
			
			this.object.desc_moneda_cnta	[row] = ls_nombre
		else
			
			//Si el Codigo de la AFP es nulo, entonces esta en ONP y tengo que 
			//limpiar todo lo relacionado con AFP
			this.object.cod_afp				[row] = gnvo_app.is_null
			this.object.desc_afp				[row] = gnvo_app.is_null
			this.object.nro_afp_trabaj		[row] = gnvo_app.is_null
			this.object.flag_comision_afp	[row] = '0'
			
		end if

	case 'cod_moneda'
		select descripcion
			into :ls_nombre
		  from moneda
		 where cod_moneda 	= :data
			and flag_estado	= '1' ;
				  
		if sqlca.sqlcode = 100 then
			this.object.cod_moneda			[row] = gnvo_app.is_null
			this.object.desc_moneda_cnta	[row] = gnvo_app.is_null
			Messagebox(this.title, 'Código de Moneda no existe o no esta activo, por favor verifique!')
			Return 1
		end if
		
		this.object.desc_moneda_cnta	[row] = ls_nombre

			
	case 'moneda_cts'
		select descripcion
			into :ls_nombre
		  from moneda
		 where cod_moneda 	= :data
			and flag_estado	= '1' ;
				  
		if sqlca.sqlcode = 100 then
			this.object.moneda_cts			[row] = gnvo_app.is_null
			this.object.desc_moneda_cts	[row] = gnvo_app.is_null
			Messagebox(this.title, 'Código de Moneda no existe o no esta activo, por favor verifique!')
			Return 1
		end if
		
		this.object.desc_moneda_cts	[row] = ls_nombre		
end choose


dw_master.ii_update = 1
end event

event itemerror;call super::itemerror;Return 1
end event

event getfocus;call super::getfocus;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event ue_display;call super::ue_display;string ls_col, ls_sql, ls_return1, ls_return2, ls_return3, ls_return4

choose case lower(as_columna)
	case 'situa_trabaj'
		ls_sql = "select situa_trabaj as situacion_trabajador, " &
				 + "desc_sit_trab as descripcion_situacion " &
				 + "from situacion_trabajador " &
				 + "where flag_estado = '1'"
				 
		
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		
		this.object.situa_trabaj		[al_row] = ls_return1
		this.object.desc_situa_trabaj	[al_row] = ls_return2
		
		this.ii_update = 1

	case 'grupo_trabaj'
		ls_sql = "select grupo_trabaj as grupo_trabajador, " &
				 + "desc_grupo_trabaj as descripcion_grupo " &
				 + "from rrhh_grupo_trabajador " &
				 + "where flag_estado = '1'"
				 
	
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		
		this.object.grupo_trabaj		[al_row] = ls_return1
		this.object.desc_grupo_trabaj	[al_row] = ls_return2
		
		this.ii_update = 1		

	case 'cod_profesion'
		ls_sql = "select cod_profesion as codigo, "&
				 + "desc_profesion as nombre_profesion "&
				 + "from profesion"
				 
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		
		this.object.cod_profesion[al_row] = ls_return1
		this.ii_update = 1
		
	case 'cod_grado_inst'
		ls_sql = "select COD_GRADO_INST as codigo, " &
				 + "DESC_INSTRUC as desc_grado " &
				 + "from GRADO_INSTRUCCION"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		
		this.object.cod_grado_inst[al_row] = ls_return1
		this.ii_update = 1
	
	case 'cod_estado_civil'
		ls_sql = "select COD_ESTADO_CIVIL as codigo, " &
				 + "DESCRIPCION as desc_estado " &
				 + "from RRHH_ESTADO_CIVIL_RTPS"
				 
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_estado_civil[al_row] = ls_return1
		this.ii_update = 1
	
	case 'tipo_doc_identidad'
		ls_sql = "select COD_DOC_IDENTIDAD as codigo, DESCRIPCION as desc_estado from rrhh_documento_identidad_rtps WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.tipo_doc_identidad[al_row] = ls_return1
		this.ii_update = 1
	
	case 'cod_origen'
		ls_sql = "select distinct o.cod_origen as cod_origen, " &
				 + "o.nombre as desc_origen " &
				 + "from ot_adm_origen oao, " &
				 + "     ot_adm_usuario oau, " &
				 + "     origen         o "&
				 + "where oau.ot_adm = oao.ot_adm  " &
				 + "  and oao.cod_origen = o.cod_origen " &
				 + "  and oau.cod_usr = '" + gs_user + "'" 
				 
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		
		this.object.cod_origen	[al_row] = ls_return1
		this.object.desc_origen	[al_row] = ls_return2
		this.ii_update = 1

	case 'cod_tipo_pension'
		ls_sql = "select cod_tipo_pension as codigo, DESCRIPCION as desc_estado from rrhh_tipo_pensiones_rtps WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_tipo_pension[al_row] = ls_return1
		this.ii_update = 1
	
	case 'cod_tip_trab'
		ls_sql = "select cod_tip_trab as codigo, DESCRIPCION as desc_estado from rrhh_tipo_trabajadores_rtps WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_tip_trab[al_row] = ls_return1
		this.ii_update = 1	
		
	case 'cod_periocidad_rem'
		ls_sql = "select cod_periocidad_rem as codigo, DESCRIPCION as desc_estado from RRHH_PERIODO_REMUN_RTPS WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_periocidad_rem[al_row] = ls_return1
		this.ii_update = 1	
	
	case 'cod_eps'
		ls_sql = "select cod_eps as codigo, DESCRIPCION as desc_estado from RRHH_EPS_RTPS WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_eps[al_row] = ls_return1
		this.ii_update = 1
	
	case 'cod_reg_pension'
		ls_sql = "select cod_reg_pension as codigo, DESCRIPCION as desc_estado from RRHH_REGIMEN_PENSIONARIO_RTPS WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_reg_pension[al_row] = ls_return1
		this.ii_update = 1
		
	case 'cod_sit_eps'
		ls_sql = "select cod_sit_eps as codigo, DESCRIPCION as desc_estado, decode(flag_afiliado, 'S', 'Si', 'N', 'No') as Afiliado from RRHH_SITUACION_EPS_RTPS WHERE FLAG_ESTADO = '1'"
		
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_sit_eps[al_row] = ls_return1
		this.ii_update = 1	
		
	case "cod_afp"
		ls_sql = "select t.cod_afp as codigo_afp, "&
				 + "t.desc_afp as descripcion_afp, "&
				 + "rpr.cod_pension_rtps as codigo_pension, "&
				 + "rpr.desc_pension_rtps as descripcion_pension "&
				 + "from admin_afp t, " &
				 + "     rrhh_pensiones_rtps rpr " &
				 + "where t.cod_pension_rtps = rpr.cod_pension_rtps "&
				 + "and t.flag_estado = '1' "
				  
		
		
		if gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, ls_Return3, ls_return4, '2') then
			this.object.cod_afp      		[al_row] = ls_return1
			this.object.desc_afp		 		[al_row] = ls_return2
			this.object.cod_pension_rtps	[al_row] = ls_return3
			this.object.desc_pension_rtps	[al_row] = ls_return4
			this.ii_update = 1
		end if

	case 'cod_banco'
			ls_sql = "select cod_banco as codigo, nom_banco as descripcion from banco"
			
			if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
			this.object.cod_banco[al_row] = ls_return1
			this.ii_update = 1	
	
	case 'cod_banco_cts'
			ls_sql = "select cod_banco as codigo, nom_banco as descripcion from banco"
			
			if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
			this.object.cod_banco_cts[al_row] = ls_return1
			this.ii_update = 1	

	case 'cod_moneda'
		ls_sql = "select cod_moneda as codigo_moneda, " &
				 + "descripcion as descripcion_moneda " &
				 + "from moneda " &
				 + "where flag_estado = '1'"
				 
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.cod_moneda			[al_row] = ls_return1
		this.object.desc_moneda_cnta	[al_row] = ls_return2
		this.ii_update = 1		

	case 'moneda_cts'
		ls_sql = "select cod_moneda as codigo_moneda, " &
				 + "descripcion as descripcion_moneda " &
				 + "from moneda " &
				 + "where flag_estado = '1'"
				 
		if not gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then return
		this.object.moneda_cts			[al_row] = ls_return1
		this.object.desc_moneda_cts	[al_row] = ls_return2
		this.ii_update = 1				
end choose
end event

event doubleclicked;call super::doubleclicked;string ls_columna, ls_string, ls_evaluate

THIS.AcceptText()

ls_string = this.Describe(lower(dwo.name) + '.Protect' )
if len(ls_string) > 1 then
 	ls_string = Mid(ls_string, Pos(ls_string, '~t') + 1)
 	ls_string = Mid(ls_string,1, len(ls_string) - 1 )
 	ls_evaluate = "Evaluate('" + ls_string + "', " + string(row) + ")"
 
 	if this.Describe(ls_evaluate) = '1' then return
else
 	if ls_string = '1' then return
end if

IF row > 0 THEN
	ls_columna = upper(dwo.name)
	THIS.event dynamic ue_display(ls_columna, row)
END IF
end event

type tabpage_6 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "RTPS"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_rtps dw_rtps
end type

on tabpage_6.create
this.dw_rtps=create dw_rtps
this.Control[]={this.dw_rtps}
end on

on tabpage_6.destroy
destroy(this.dw_rtps)
end on

type dw_rtps from u_dw_abc within tabpage_6
event ue_display ( string as_columna,  long al_row )
integer width = 2935
integer height = 1100
integer taborder = 30
string dataobject = "d_abc_maestro_personal_rtps_ff"
borderstyle borderstyle = styleraised!
end type

event ue_display;boolean 	lb_ret
string 	ls_codigo, ls_data, ls_sql, ls_nro_orden, ls_null, &
			ls_oper_sec, ls_cencos, ls_desc_cencos, ls_cencos_r, ls_desc_cencos_r, &
			ls_pais, ls_dpto, ls_prov
Long		ll_row_find

Setnull(ls_null)

str_parametros sl_param

choose case lower(as_columna)
		
	case "cod_tipo_pension"

		ls_sql = "select cod_tipo_pension as codigo, "&
				 + "DESCRIPCION as desc_estado " &
				 + "from rrhh_tipo_pensiones_rtps " &
				 + "WHERE FLAG_ESTADO = '1'"
				 
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.COD_TIPO_PENSION  [al_row] = ls_codigo
		end if
		
		
	case "cod_tip_trab"

		ls_sql = "select cod_tip_trab as codigo, "&
			  	 + "DESCRIPCION as desc_estado "&
				 + "from rrhh_tipo_trabajadores_rtps "&
				 + "WHERE FLAG_ESTADO = '1'"
				 
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.cod_tip_trab	[al_row] = ls_codigo
		end if
		
	case "cod_empresa"

		ls_sql = "SELECT COD_EMPRESA AS CODIGO, " &
				  + "nombre AS DESC_tipo " &
				  + "FROM EMPRESA "
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.cod_empresa	[al_row] = ls_codigo
		end if
		
	case "cod_mod_pago_rtps"

		ls_sql = "SELECT COD_MOD_PAGO_RTPS AS CODIGO, " &
				  + "DESC_MOD_PAGO_RTPS AS DESCRIPCION " &
				  + "FROM RRHH_MODALIDAD_PAGO_RTPS "&
				  + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.COD_MOD_PAGO_RTPS	[al_row] = ls_codigo
		end if
		
	case "cod_periocidad_rem"
		
		ls_sql = "select cod_periocidad_rem as codigo, "&
				 + "DESCRIPCION as DESC_PERIOCIDAD "&
				 + "from RRHH_PERIODO_REMUN_RTPS "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.COD_PERIOCIDAD_REM	[al_row] = ls_codigo
		end if
		
	case "cod_ocupacion_rtps"
		
		ls_sql = "select COD_OCUPACION_RTPS as codigo, "&
				 + "DESC_OCUPACION AS DESCRIPCION "&
				 + "from RRHH_OCUPACION_RTPS "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.COD_OCUPACION_RTPS	[al_row] = ls_codigo
		end if

   case "cod_tipo_sangre"
		
		ls_sql = "select trim(COD_TIPO_SANGRE) as codigo, "&
				 + "DESC_SANGRE AS DESCRIPCION "&
				 + "from TIPO_SANGRE "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.COD_TIPO_SANGRE	[al_row] = ls_codigo
		end if
		
	case "cod_eps" 
		
		ls_sql = "select cod_eps as codigo, "&
				 + "DESCRIPCION as desc_estado "&
				 + "from RRHH_EPS_RTPS "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.cod_eps	[al_row] = ls_codigo
		end if
		
   case "cod_sit_eps" 
		
		ls_sql = "select cod_sit_eps as codigo, "&
				 + "DESCRIPCION as desc_estado, "&
				 + "decode(flag_afiliado, 'S', 'Si', 'N', 'No') as Afiliado "&
				 + "from RRHH_SITUACION_EPS_RTPS "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.cod_sit_eps	[al_row] = ls_codigo
		end if
		
	case 'cod_tipo_contrato'
		
		ls_sql = "select cod_tipo_contrato as codigo, "&
				 + "DESCRIPCION as desc_estado "&
				 + "from rrhh_tipos_contrato_rtps "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.COD_TIPO_CONTRATO	[al_row] = ls_codigo
		end if
		
   case 'cod_reg_pension'
		
		ls_sql = "select cod_reg_pension as codigo, "&
				 + "DESCRIPCION as desc_estado "&
				 + "from RRHH_REGIMEN_PENSIONARIO_RTPS "&
				 + "WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.COD_REG_PENSION	[al_row] = ls_codigo
		end if

	case 'cod_pais_nac'

				ls_sql = "select cod_pais as codigo, "&
						 + "nom_pais as desc_pais "&
						 + "from pais"
				  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
			if ls_codigo <> '' then
				this.object.COD_PAIS_NAC	[al_row] = ls_codigo
				this.object.desc_pais_n 	[al_row] = ls_data
			end if
		
			//limpiar departamento provincia distrito
			this.object.cod_dpto_nac   [al_row] = ls_null		
			this.object.cod_prov_nac   [al_row] = ls_null		
			this.object.cod_dist_nac  [al_row] = ls_null
			
			this.object.desc_depto_n    [al_row] = ls_null		
			this.object.desc_prov_n     [al_row] = ls_null		
			this.object.desc_distrito_n [al_row] = ls_null		
	
	case 'cod_dpto_nac'
			
			ls_pais = this.object.COD_PAIS_NAC  [al_row]	
			
			ls_sql = "select cod_dpto as codigo, "&
					 + "desc_dpto as descripcion "&
					 + "from departamento_estado " &
					 + "where cod_pais = '"+ls_pais+"'"
				  
			lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
			if ls_codigo <> '' then
				this.object.cod_dpto_nac	[al_row] = ls_codigo
				this.object.desc_depto_n 	[al_row] = ls_data
			end if

			//limpiar departamento provincia 
			this.object.cod_prov_nac   [al_row] = ls_null		
			this.object.cod_dist_nac  [al_row] = ls_null
			
			this.object.desc_prov_n     [al_row] = ls_null		
			this.object.desc_distrito_n [al_row] = ls_null		
				
	case 'cod_prov_nac'
			
		ls_pais = this.object.COD_PAIS_NAC [al_row]
		ls_dpto = this.object.cod_dpto_nac [al_row]
		
		ls_sql = "select cod_prov as codigo, "&
				 + "desc_prov as descripcion "&
				 + "from provincia_condado "&
				 + "where cod_pais = '"+ls_pais+"' "&
				 + "and cod_dpto = '"+ls_dpto+"'"
														  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.cod_prov_nac	[al_row] = ls_codigo
			this.object.desc_prov_n 	[al_row] = ls_data
		end if
		
		//limpiar departamento provincia 
		this.object.cod_dist_nac  [al_row] = ls_null
		this.object.desc_distrito_n [al_row] = ls_null	
				
	case 'cod_dist_nac'
			
		ls_pais = this.object.COD_PAIS_NAC [al_row]
		ls_dpto = this.object.cod_dpto_nac [al_row]
		ls_prov = this.object.cod_prov_nac [al_row]
		
		ls_sql = "select cod_distr as codigo, "&
				 + "desc_distrito as descripcion "&
				 + "from distrito "&
				 + "where cod_pais  = '"+ls_pais+"'"&
				 + "  and cod_dpto  = '"+ls_dpto+"'"&
				 + "  and cod_prov  = '"+ls_prov+"'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.cod_dist_nac		[al_row] = ls_codigo
			this.object.desc_distrito_n 	[al_row] = ls_data
		end if
		
	case "cod_pension_rtps"
		ls_sql = "select t.cod_pension_rtps as cod_pension_rtps, " &
				 + "t.desc_pension_rtps as desc_pension_rtps, " &
				 + "t.flag_estado as flag_estado " &
				 + "from rrhh_pensiones_rtps t " &
				 + "where t.flag_estado = '1' " 

				 
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.cod_pension_rtps		[al_row] = ls_codigo
			this.object.desc_pension_rtps		[al_row] = ls_data
			this.ii_update = 1
		end if
		
		return

end choose
end event

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                       	// 'md' = master con detalle, 'dd' = detalle con detalle a la vez



ii_ck[1] = 1				// columnas de lectrua de este dw



idw_mst = dw_master

end event

event doubleclicked;call super::doubleclicked;string 	ls_columna
long		ll_row

Accepttext()

dw_master.ii_update = 1

IF This.describe(dwo.Name + ".Protect") = '1' Then RETURN
ll_row = row

If ll_row > 0 Then
	ls_columna = upper(dwo.name)
	This.event dynamic ue_display(ls_columna, ll_row)
end if
end event

event itemchanged;call super::itemchanged;String ls_null, ls_desc
Long   ll_count

Accepttext()


SetNull(ls_null)

choose case lower(dwo.name)
	
	case "cod_pension_rtps"
			
		SELECT desc_pension_rtps
			INTO :ls_desc
		FROM rrhh_pensiones_rtps
   	WHERE  cod_pension_rtps = :data
		  and flag_estado = '1';
		  
		IF SQLCA.SQLCODE = 100 or SQLCA.SQLCode < 0 THEN
			if SQLCA.SQLCode = 100 then
				Messagebox('Aviso','Codigo de pension RTPS no existe ' &
					+ 'no esta activo, por favor verifique')
			else
				MessageBox('Aviso', SQLCA.SQLErrText)
			end if
			this.Object.cod_pension_rtps		[row] = ls_null
			this.object.desc_pension_rtps 	[row] = ls_null
			this.setcolumn( "cod_pension_rtps" )
		 	this.setfocus()
			RETURN 1
		END IF
		this.object.desc_pension_rtps [row] = ls_desc
		
END CHOOSE

end event

event itemerror;call super::itemerror;Return 1
end event

type tabpage_2 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Datos Familiares"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
string picturename = "Move!"
long picturemaskcolor = 536870912
dw_detail_carga_det dw_detail_carga_det
dw_detail_carga dw_detail_carga
end type

on tabpage_2.create
this.dw_detail_carga_det=create dw_detail_carga_det
this.dw_detail_carga=create dw_detail_carga
this.Control[]={this.dw_detail_carga_det,&
this.dw_detail_carga}
end on

on tabpage_2.destroy
destroy(this.dw_detail_carga_det)
destroy(this.dw_detail_carga)
end on

type dw_detail_carga_det from u_dw_abc within tabpage_2
event ue_display ( string as_columna,  long al_row )
integer y = 436
integer width = 3168
integer height = 752
integer taborder = 30
string dataobject = "d_abc_carga_familiar_det_ff"
borderstyle borderstyle = styleraised!
end type

event ue_display(string as_columna, long al_row);boolean 	lb_ret
string 	ls_codigo, ls_data, ls_sql, ls_nro_orden, ls_null, &
			ls_oper_sec, ls_cencos, ls_desc_cencos, ls_cencos_r, ls_desc_cencos_r, &
			ls_pais, ls_dpto, ls_prov
Long		ll_row_find

Setnull(ls_null)

str_parametros sl_param

choose case upper(as_columna)
		
  case "CARGA_FAMILIAR_COD_GRADO_INST"

		ls_sql = "select COD_GRADO_INST as codigo, DESC_INSTRUC as desc_grado from GRADO_INSTRUCCION"
				 
		lb_ret = f_lista(ls_sql, ls_codigo, &
					ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_COD_GRADO_INST  [al_row] = ls_codigo
		end if		
		
	case 'CARGA_FAMILIAR_COD_DOC_IDENTIDAD'
		
		ls_sql = "select COD_DOC_IDENTIDAD as codigo, DESCRIPCION as desc_estado from rrhh_documento_identidad_rtps WHERE FLAG_ESTADO = '1'"

		lb_ret = f_lista(ls_sql, ls_codigo, &
					ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_COD_DOC_IDENTIDAD  [al_row] = ls_codigo
		end if
				
	case "CARGA_FAMILIAR_COD_BAJA_DH"

		ls_sql = "select cod_baja_dh as codigo, DESCRIPCION as desc_baja from RRHH_BAJA_DERECHOHABIENTE_RTPS WHERE FLAG_ESTADO = '1'"
				 
		lb_ret = f_lista(ls_sql, ls_codigo, &
					ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_COD_BAJA_DH	[al_row] = ls_codigo
		end if
		
	case "CARGA_FAMILIAR_OCUPACION"
		
		ls_sql = "select COD_OCUPACION_RTPS as codigo, DESC_OCUPACION AS DESCRIPCION from RRHH_OCUPACION_RTPS WHERE FLAG_ESTADO = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_OCUPACION	[al_row] = ls_codigo
		end if
		
	case	'CARGA_FAMILIAR_COD_VIA_DER_HAB'
		
		ls_sql = "select cod_via as codigo,descripcion as descripcion from rrhh_vias_rtps where flag_estado  = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_COD_VIA_DER_HAB	[al_row] = ls_codigo
		end if					  

	case	'CARGA_FAMILIAR_COD_ZONA_DER_HAB'
			
		ls_sql = "select cod_zona as codigo,descripcion as descripcion from rrhh_zonas_rtps where flag_estado  = '1'"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_COD_ZONA_DER_HAB	[al_row] = ls_codigo
		end if
		
		case	'CARGA_FAMILIAR_COD_NAC_DER_HAB'
		
		ls_sql = "select cod_pais as codigo, nom_pais as desc_pais from pais"
				  
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
		if ls_codigo <> '' then
			this.object.CARGA_FAMILIAR_COD_NAC_DER_HAB	[al_row] = ls_codigo
		end if
		
		case 'CARGA_FAMILIAR_COD_PAIS_DER_HAB'

				ls_sql = "select cod_pais as codigo, nom_pais as desc_pais from pais"
				  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
			if ls_codigo <> '' then
				this.object.CARGA_FAMILIAR_COD_PAIS_DER_HAB	[al_row] = ls_codigo
				this.object.desc_pais [al_row] = ls_data
			end if
		
				//limpiar departamento provincia distrito
				this.object.carga_familiar_cod_dpto_der_hab   [al_row] = ls_null		
				this.object.carga_familiar_cod_prov_der_hab   [al_row] = ls_null		
				this.object.carga_familiar_cod_distr_der_hab  [al_row] = ls_null
				
				this.object.desc_depto    [al_row] = ls_null		
				this.object.desc_prov     [al_row] = ls_null		
				this.object.desc_distrito [al_row] = ls_null		
	
		 case 'CARGA_FAMILIAR_COD_DPTO_DER_HAB'
			
			ls_pais = this.object.CARGA_FAMILIAR_COD_PAIS_DER_HAB  [al_row]	
			
			ls_sql = "select cod_dpto as codigo, desc_dpto as descripcion from departamento_estado " &
						  +" where cod_pais = "+"'"+ls_pais+"'"
				  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
			if ls_codigo <> '' then
				this.object.CARGA_FAMILIAR_COD_DPTO_DER_HAB	[al_row] = ls_codigo
				this.object.desc_depto[al_row] = ls_data
			end if

		
				//limpiar departamento provincia 
				this.object.carga_familiar_cod_prov_der_hab   [al_row] = ls_null		
				this.object.carga_familiar_cod_distr_der_hab  [al_row] = ls_null
				
				this.object.desc_prov     [al_row] = ls_null		
				this.object.desc_distrito [al_row] = ls_null		
				
		 case 'CARGA_FAMILIAR_COD_PROV_DER_HAB'
			
				ls_pais = this.object.CARGA_FAMILIAR_COD_PAIS_DER_HAB [al_row]
				ls_dpto = this.object.CARGA_FAMILIAR_COD_DPTO_DER_HAB [al_row]
		
				ls_sql = "select cod_prov as codigo, desc_prov as descripcion from provincia_condado "&
						  +"where cod_pais = "+"'"+ls_pais+"' and " &
						  +"      cod_dpto = "+"'"+ls_dpto+"'"
                                                  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
			if ls_codigo <> '' then
				this.object.CARGA_FAMILIAR_COD_PROV_DER_HAB	[al_row] = ls_codigo
				this.object.desc_prov [al_row] = ls_data
			end if
		
				//limpiar departamento provincia 
				this.object.carga_familiar_cod_distr_der_hab  [al_row] = ls_null
				this.object.desc_distrito [al_row] = ls_null	
				
		 case 'CARGA_FAMILIAR_COD_DISTR_DER_HAB'
			
				ls_pais = this.object.CARGA_FAMILIAR_COD_PAIS_DER_HAB [al_row]
				ls_dpto = this.object.CARGA_FAMILIAR_COD_DPTO_DER_HAB [al_row]
				ls_prov = this.object.CARGA_FAMILIAR_COD_PROV_DER_HAB [al_row]
		
				ls_sql = "select cod_distr as codigo ,desc_distrito as descripcion from distrito "&
						  +" where cod_pais  = "+"'"+ls_pais+"' and "&
						  +"       cod_dpto	= "+"'"+ls_dpto+"' and "&
						  +"		  cod_prov	= "+"'"+ls_prov+"'"
						  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
				if ls_codigo <> '' then
					this.object.CARGA_FAMILIAR_COD_DISTR_DER_HAB	[al_row] = ls_codigo
					this.object.desc_distrito [al_row] = ls_data
				end if
				
				/// inscripcion
				
			case 'CARGA_FAMILIAR_COD_PAIS_MUN_INS'
//				
//				ls_codigo = ls_null
//				ls_data   = ls_null 

				ls_sql = "select cod_pais as codigo, nom_pais as desc_pais from pais"
				  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
			if ls_codigo <> '' then
				this.object.CARGA_FAMILIAR_COD_PAIS_MUN_INS	[al_row] = ls_codigo
				this.object.pais_m [al_row] = ls_data
			end if
		
				//limpiar departamento provincia 
				this.object.carga_familiar_cod_dpto_mun_ins   [al_row] = ls_null		
				this.object.carga_familiar_cod_prov_mun_ins   [al_row] = ls_null		
				this.object.carga_familiar_cod_distr_mun_ins  [al_row] = ls_null
				
								
				this.object.depto_m    [al_row] = ls_null		
				this.object.prov_m     [al_row] = ls_null		
				this.object.distrito_m [al_row] = ls_null		
	
		 case 'CARGA_FAMILIAR_COD_DPTO_MUN_INS'
			
			ls_pais = this.object.CARGA_FAMILIAR_COD_PAIS_MUN_INS  [al_row]	
			
			ls_sql = "select cod_dpto as codigo, desc_dpto as descripcion from departamento_estado " &
						  +" where cod_pais = "+"'"+ls_pais+"'"
				  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
			if ls_codigo <> '' then
				this.object.CARGA_FAMILIAR_COD_DPTO_MUN_INS	[al_row] = ls_codigo
				this.object.depto_m [al_row] = ls_data
			end if

		
				//limpiar departamento provincia 
				this.object.carga_familiar_cod_prov_mun_ins   [al_row] = ls_null		
				this.object.carga_familiar_cod_distr_mun_ins  [al_row] = ls_null	
				
				this.object.prov_m     [al_row] = ls_null		
				this.object.distrito_m [al_row] = ls_null	
				
		 case 'CARGA_FAMILIAR_COD_PROV_MUN_INS'
			
				ls_pais = this.object.CARGA_FAMILIAR_COD_PAIS_MUN_INS [al_row]
				ls_dpto = this.object.CARGA_FAMILIAR_COD_DPTO_MUN_INS [al_row]
		
				ls_sql = "select cod_prov as codigo, desc_prov as descripcion from provincia_condado "&
						  +"where cod_pais = "+"'"+ls_pais+"' and " &
						  +"      cod_dpto = "+"'"+ls_dpto+"'"
                                                  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
			if ls_codigo <> '' then
				this.object.CARGA_FAMILIAR_COD_PROV_MUN_INS	[al_row] = ls_codigo
				this.object.prov_m [al_row] = ls_data
			end if
		
				//limpiar departamento provincia 
				this.object.carga_familiar_cod_distr_mun_ins  [al_row] = ls_null
				this.object.distrito_m [al_row] = ls_null
				
		 case 'CARGA_FAMILIAR_COD_DISTR_MUN_INS'
			
				ls_pais = this.object.CARGA_FAMILIAR_COD_PAIS_MUN_INS [al_row]
				ls_dpto = this.object.CARGA_FAMILIAR_COD_DPTO_MUN_INS [al_row]
				ls_prov = this.object.CARGA_FAMILIAR_COD_PROV_MUN_INS [al_row]
		
				ls_sql = "select cod_distr as codigo ,desc_distrito as descripcion from distrito "&
						  +" where cod_pais  = "+"'"+ls_pais+"' and "&
						  +"       cod_dpto	= "+"'"+ls_dpto+"' and "&
						  +"		  cod_prov	= "+"'"+ls_prov+"'"
						  
				lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '1')
		
				if ls_codigo <> '' then
					this.object.CARGA_FAMILIAR_COD_DISTR_MUN_INS	[al_row] = ls_codigo
					this.object.distrito_m [al_row] = ls_data
				end if
end choose
end event

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                       	// 'md' = master con detalle, 'dd' = detalle con detalle a la vez



ii_ck[1] = 1				// columnas de lectrua de este dw



idw_mst = dw_master

end event

event doubleclicked;call super::doubleclicked;string 	ls_columna
long		ll_row

Accepttext()

dw_detail_carga.ii_update = 1

IF This.describe(dwo.Name + ".Protect") = '1' Then RETURN
ll_row = row

If ll_row > 0 Then
	ls_columna = upper(dwo.name)
	This.event dynamic ue_display(ls_columna, ll_row)
end if
end event

event itemchanged;call super::itemchanged;Accepttext()

dw_detail_carga.ii_update = 1
end event

event itemerror;call super::itemerror;Return 1
end event

type dw_detail_carga from u_dw_abc within tabpage_2
event ue_display ( string as_columna,  long al_row )
integer width = 3168
integer height = 428
integer taborder = 20
string dataobject = "d_abc_maestro_carga_fam_tbl"
end type

event ue_display(string as_columna, long al_row);boolean 	lb_ret
string 	ls_codigo, ls_data, ls_sql, ls_nro_orden, ls_null, &
			ls_oper_sec, ls_cencos, ls_desc_cencos, ls_cencos_r, ls_desc_cencos_r, &
			ls_pais, ls_dpto, ls_prov
Long		ll_row_find

Setnull(ls_null)

str_parametros sl_param

choose case upper(as_columna)
		
	case 'COD_ESTADO_CIVIL'
		
		ls_sql = "select COD_ESTADO_CIVIL as codigo, DESCRIPCION as desc_estado from RRHH_ESTADO_CIVIL_RTPS"
				 
		lb_ret = f_lista(ls_sql, ls_codigo, &
					ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.cod_estado_civil  [al_row] = ls_codigo
		end if
		
		this.ii_update = 1
		
end choose
end event

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                     // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
is_dwform = 'tabular'	// tabular, form (default)


ii_ck[1] = 1				// columnas de lectrua de este dw
ii_ck[2] = 2


idw_mst  = 	idw_detail_carga

end event

event ue_insert_pre;//Override

this.object.nro_item	[al_row] = string(of_nro_item(this))

IF is_mastdet = 'dd' OR is_mastdet = 'd' THEN
	Any  la_id
	Integer li_x
	FOR li_x = 1 TO UpperBound(idw_mst.ii_dk)
		la_id = idw_mst.object.data.primary.current[idw_mst.il_row, idw_mst.ii_dk[li_x]]
		THIS.SetItem(al_row, ii_rk[li_x], la_id)
	NEXT
END IF

this.ii_update = 1


//messagebox('traba', 


//Long ll_rowcount,ll_item
//
//this.object.secuencia [al_row]
//
//ll_rowcount = this.RowCount()	
//	 
//IF ll_rowcount = 1 THEN 
//   ll_item = 0
//ELSE
//   ll_item = Long(this.GetItemString(ll_rowcount - 1,"secuencia"))
//END IF
//
//this.SetItem(al_row, "secuencia", trim(String(ll_item + 1))) 
end event

event itemchanged;call super::itemchanged;this.Accepttext()
end event

event itemerror;call super::itemerror;return 1
end event

event rowfocuschanged;call super::rowfocuschanged;IF currentrow > 0 THEN
	This.SelectRow(0,false)
	This.SelectRow(currentrow,true)
	idw_detail_carga_det.Scrolltorow(currentrow)
END IF

end event

event doubleclicked;call super::doubleclicked;string 	ls_columna
long		ll_row

Accepttext()

dw_detail_carga.ii_update = 1

IF This.describe(dwo.Name + ".Protect") = '1' Then RETURN
ll_row = row

If ll_row > 0 Then
	ls_columna = upper(dwo.name)
	This.event dynamic ue_display(ls_columna, ll_row)
end if
end event

type tabpage_3 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Otros"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
string picturename = "InsertReturn!"
long picturemaskcolor = 536870912
dw_detail_otros dw_detail_otros
end type

on tabpage_3.create
this.dw_detail_otros=create dw_detail_otros
this.Control[]={this.dw_detail_otros}
end on

on tabpage_3.destroy
destroy(this.dw_detail_otros)
end on

type dw_detail_otros from u_dw_abc within tabpage_3
integer width = 3566
integer height = 1092
integer taborder = 20
string dataobject = "d_abc_maestro_personal_det_otros_tbl"
borderstyle borderstyle = styleraised!
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
	                  // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
//is_dwform = 'tabular'	// tabular, form (default)



ii_ck[1] = 1				// columnas de lectrua de este dw


idw_mst = idw_detail_otros

end event

event itemchanged;call super::itemchanged;String ls_desc,ls_null,ls_pais,ls_dpto,ls_prov

Setnull(ls_null)

dw_master.ii_update = 1

choose case dwo.name
		 case 'cod_cargo'
			
				select desc_cargo into :ls_desc
				  from cargo
				 where (trim(cod_cargo) = trim(:data));
				
				if sqlca.sqlcode = 100 then
					
					this.object.cod_cargo  [row] = ls_null
					this.object.desc_cargo [row] = ls_null
					Messagebox(this.title, 'Cargo Inexistente')
					Return 1
				else
					this.object.desc_cargo [row] = ls_desc
				end if
				

		
		
		 case 'cod_pais'
				
				//limpiar departamento provincia 
				this.object.cod_dpto      [row] = ls_null		
				this.object.cod_prov      [row] = ls_null		
				this.object.cod_distr     [row] = ls_null		

				this.object.desc_depto    [row] = ls_null		
				this.object.desc_prov     [row] = ls_null		
				this.object.desc_distrito [row] = ls_null		

				
	
				select nom_pais into :ls_desc
				  from pais
				 where (cod_pais = :data) ;
				 
				if sqlca.sqlcode = 100 then
					this.object.cod_pais  [row] = ls_null
					this.object.desc_pais [row] = ls_null
					Messagebox('Aviso','Pais No Existe ,Verifique!')
					Return 1
				else
					this.object.desc_pais [row] = ls_desc
				end if
				

		 case 'cod_dpto'
				//limpiar departamento provincia 
				this.object.cod_prov      [row] = ls_null		
				this.object.cod_distr     [row] = ls_null		
	
				this.object.desc_prov     [row] = ls_null		
				this.object.desc_distrito [row] = ls_null		
	
		
				ls_pais = this.object.cod_pais  [row]	
				
				if Isnull(ls_pais) or Trim(ls_pais) = '' then
					Messagebox('Aviso','Debe Ingresar Codigo de Pais ,Verifique!')
					this.object.cod_dpto [row] = ls_null
					Return 1
				end if
				
				select desc_dpto into :ls_desc
				  from departamento_estado 
				 where (cod_pais = :ls_pais ) and
				 		 (cod_dpto = :data	 ) ;

				if sqlca.sqlcode = 100 then
					this.object.cod_dpto  [row] = ls_null
					this.object.desc_depto[row] = ls_null
					Messagebox('Aviso','Departamanento No Existe ,Verifique!')
					Return 1
				else
					this.object.desc_depto[row] = ls_desc
				end if
		

		 case 'cod_prov'
				//limpiar departamento provincia 
				this.object.cod_distr     [row] = ls_null		
				this.object.desc_distrito [row] = ls_null		


				
				ls_pais = this.object.cod_pais [row]
				ls_dpto = this.object.cod_dpto [row]
				
				if Isnull(ls_pais) or Trim(ls_pais) = '' then
					Messagebox('Aviso','Debe Ingresar Codigo de Pais ,Verifique!')
					this.object.cod_prov [row] = ls_null
					Return 1
				end if
				
				if Isnull(ls_dpto) or Trim(ls_dpto) = '' then
					Messagebox('Aviso','Debe Ingresar Codigo de Departamento ,Verifique!')
					this.object.cod_prov [row] = ls_null
					Return 1
				end if
				
		
				SELECT desc_prov into :ls_desc
				  FROM provincia_condado 
				 WHERE (cod_pais = :ls_pais ) and 
				       (cod_dpto = :ls_dpto ) and
				  		 (cod_prov = :data    ) ;
                                                  

				if sqlca.sqlcode = 100 then
					this.object.cod_prov  [row] = ls_null
					this.object.desc_prov [row] = ls_null
					Messagebox('Aviso','Provincia No Existe ,Verifique!')
					Return 1
				else
					this.object.desc_prov [row] = ls_desc
				end if


		 case 'cod_distr'
				ls_pais = this.object.cod_pais [row]
				ls_dpto = this.object.cod_dpto [row]
				ls_prov = this.object.cod_prov [row]
		
				if Isnull(ls_pais) or Trim(ls_pais) = '' then
					Messagebox('Aviso','Debe Ingresar Codigo de Pais ,Verifique!')
					this.object.cod_distr [row] = ls_null
					Return 1
				end if
				
				if Isnull(ls_dpto) or Trim(ls_dpto) = '' then
					Messagebox('Aviso','Debe Ingresar Codigo de Departamento ,Verifique!')
					this.object.cod_distr [row] = ls_null
					Return 1
				end if		
				
		
				if Isnull(ls_prov) or Trim(ls_prov) = '' then
					Messagebox('Aviso','Debe Ingresar Codigo de Provincia ,Verifique!')
					this.object.cod_distr [row] = ls_null
					Return 1
				end if		
		
				SELECT desc_distrito INTO :ls_desc
				  FROM distrito
				 WHERE (cod_pais  = :ls_pais ) and
				  		 (cod_dpto  = :ls_dpto ) and 
				  		 (cod_prov  = :ls_prov ) and
						 (cod_distr = :data	  ) ;

				if sqlca.sqlcode = 100 then                                                  
					this.object.cod_distr     [row] = ls_null
					this.object.desc_distrito [row] = ls_null
					Messagebox('Aviso','Debe Ingresar Codigo de Distrito ,Verifique!')
					Return 1
				else
					this.object.desc_distrito [row] = ls_desc
				end if

	

		 case	'centro_benef'
			
				select desc_centro into :ls_desc from centro_beneficio
				 where flag_estado  = '1'   and
				 		 centro_benef = :data ; 			

				if sqlca.sqlcode = 100 then                                                  
					this.object.centro_benef [row] = ls_null
					this.object.desc_centro  [row] = ls_null
					Messagebox('Aviso','Debe Ingresar Codigo de Centro de Beneficio ,Verifique!')
					Return 1
				else
					this.object.desc_centro [row] = ls_desc
				end if			

			   dw_master.ii_update = 1					
				
				
		case	'cod_via'	
				select descripcion into :ls_desc from rrhh_vias_rtps	
				 where (cod_via     = :data ) and 
				 		 (flag_estado = '1'   )	;
						  
				if sqlca.sqlcode = 100 then                                                  
					this.object.cod_via    [row]	= ls_null
					this.object.nombre_via [row]	= ls_null

					Messagebox('Aviso','Debe Ingresar Codigo de Via,Verifique!')
					Return 1
				else
					this.object.nombre_via [row]	= ls_desc
				end if			

			   dw_master.ii_update = 1									  
		case	'cod_zona'			
			
				select descripcion into :ls_desc from rrhh_zonas_rtps	
				 where (cod_zona     = :data ) and 
				 		 (flag_estado = '1'   )	;
						  
						  
				if sqlca.sqlcode = 100 then                                                  
					this.object.cod_zona    [row]	= ls_null
					this.object.nombre_zona [row]	= ls_null

					Messagebox('Aviso','Debe Ingresar Codigo de Zona,Verifique!')
					Return 1
				else
					this.object.nombre_zona [row]	= ls_desc
				end if			

			   dw_master.ii_update = 1									  
						  
			
		
end choose


end event

event itemerror;call super::itemerror;Return 1
end event

event doubleclicked;call super::doubleclicked;String ls_sql,ls_null,ls_return1,ls_return2,ls_pais,ls_dpto,ls_prov

if this.ii_protect = 1 or row = 0 then return


Setnull(ls_null)


choose case dwo.name
		 case 'cod_cargo'
				ls_sql = "select cod_cargo as codigo, " &
						 + "desc_cargo as descripcion "&
						 + "from cargo " &
						 + "where flag_estado='1' " 
		 		f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.cod_cargo [row] = ls_return1
				this.object.desc_cargo[row] = ls_return2
				dw_master.ii_update = 1
		
	    case 'cod_pais'
				ls_sql = "select cod_pais as codigo, "&
						 + "nom_pais as desc_pais "&
						 + "from pais"
				f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.cod_pais  [row] = ls_return1
				this.object.desc_pais [row] = ls_return2
		
				//limpiar departamento provincia 
				this.object.cod_dpto   [row] = ls_null		
				this.object.cod_prov   [row] = ls_null		
				this.object.cod_distr  [row] = ls_null		
			
		
				this.object.desc_depto    [row] = ls_null		
				this.object.desc_prov     [row] = ls_null		
				this.object.desc_distrito [row] = ls_null		
	
		
				dw_master.ii_update = 1	
	
		 case 'cod_dpto'
				ls_pais = this.object.cod_pais  [row]	
				ls_sql = "select cod_dpto as codigo, desc_dpto as descripcion from departamento_estado " &
						  +" where cod_pais = "+"'"+ls_pais+"'"

				f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.cod_dpto  [row] = ls_return1
				this.object.desc_depto[row] = ls_return2
		
				//limpiar departamento provincia 
				this.object.cod_prov   [row] = ls_null		
				this.object.cod_distr  [row] = ls_null		
		
			
				this.object.desc_prov     [row] = ls_null		
				this.object.desc_distrito [row] = ls_null		
		
		
				dw_master.ii_update = 1	
				
		 case 'cod_prov'
				ls_pais = this.object.cod_pais [row]
				ls_dpto = this.object.cod_dpto [row]
		
				ls_sql = "select cod_prov as codigo, desc_prov as descripcion from provincia_condado "&
						  +"where cod_pais = "+"'"+ls_pais+"' and " &
						  +"      cod_dpto = "+"'"+ls_dpto+"'"
                                                  
				f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.cod_prov  [row] = ls_return1
				this.object.desc_prov [row] = ls_return2
		
				//limpiar departamento provincia 
				this.object.cod_distr  [row] = ls_null		

			
				this.object.desc_distrito [row] = ls_null		

			
				dw_master.ii_update = 1	
				
		 case 'cod_distr'
				ls_pais = this.object.cod_pais [row]
				ls_dpto = this.object.cod_dpto [row]
				ls_prov = this.object.cod_prov [row]
		
				ls_sql = "select cod_distr as codigo ,desc_distrito as descripcion from distrito "&
						  +" where cod_pais  = "+"'"+ls_pais+"' and "&
						  +"       cod_dpto	= "+"'"+ls_dpto+"' and "&
						  +"		  cod_prov	= "+"'"+ls_prov+"'"

                                                  
				f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.cod_distr     [row] = ls_return1
				this.object.desc_distrito [row] = ls_return2 	
		
				dw_master.ii_update = 1	
				
				
	  case 'calif_tipo'
		     ls_sql = "select calif_tipo as codigo,descripcion as descripcion,nro_marcacion_dia as marcaciones from rrhh_calificacion_tipo "&
						 +" where flag_estado  = "+"'"+'1'+"'"

                                                  
			  f_lista(ls_sql, ls_return1, ls_return2, '2')
		     if isnull(ls_return1) or trim(ls_return1) = '' then return
		     this.object.calif_tipo  [row] = ls_return1
		     this.object.descripcion [row] = ls_return2 	

			  dw_master.ii_update = 1			
			  
				
		case	'cod_via'	
	
				
				ls_sql = "select cod_via as codigo,descripcion as descripcion from rrhh_vias_rtps "&
						 +" where flag_estado  = "+"'"+'1'+"'"
						 
			   f_lista(ls_sql, ls_return1, ls_return2, '2')
		      if isnull(ls_return1) or trim(ls_return1) = '' then return
		      this.object.cod_via    [row] = ls_return1
		      this.object.nombre_via [row] = ls_return2 	

			  dw_master.ii_update = 1						  

		case	'cod_zona'	
	
				
				ls_sql = "select cod_zona as codigo,descripcion as descripcion from rrhh_zonas_rtps "&
						 +" where flag_estado  = "+"'"+'1'+"'"
						 
			   f_lista(ls_sql, ls_return1, ls_return2, '2')
		      if isnull(ls_return1) or trim(ls_return1) = '' then return
		      this.object.cod_zona    [row] = ls_return1
		      this.object.nombre_zona [row] = ls_return2 	

			  dw_master.ii_update = 1				
			
		case	'cod_motiv_cese'		
				
				ls_sql = "select cod_motiv_cese as codigo, desc_motiv_cese as descripcion from motivo_cese "
						 
			   f_lista(ls_sql, ls_return1, ls_return2, '2')
		      if isnull(ls_return1) or trim(ls_return1) = '' then return
		      this.object.cod_motiv_cese    [row] = ls_return1
		      //this.object.desc_motivo_cese [row] = ls_return2 	

			  dw_master.ii_update = 1				
			
end choose

end event

event ue_insert_pre;call super::ue_insert_pre;this.object.porc_judicial 	[al_row] = 0.00
this.object.porc_jud_util 	[al_row] = 0.00
this.object.porc_jud_cts 	[al_row] = 0.00
this.object.porc_jud_grat 	[al_row] = 0.00
this.object.porc_jud_vacac [al_row] = 0.00
end event

event buttonclicked;call super::buttonclicked;String			ls_cod_cargo, ls_Directorio, ls_desc_cargo
blob				lbl_manual_mof
Integer			li_filenum
n_cst_wait		invo_wait

if row = 0 then return

try 
	ls_cod_cargo 	= this.object.cod_cargo 	[row]
	ls_desc_cargo 	= this.object.desc_cargo 	[row]
	
	if lower(dwo.name) = 'b_mof' then
		
		if ISNull(ls_cod_cargo) or trim(ls_Cod_cargo) = '' then
			gnvo_app.of_mensaje_Error("Debe seleccionar un codigo de cargo primero, por favor corrija!")
			return
		end if
		
		if GetFolder("Seleccione el Directorio para guardar los documentos digitales",ls_Directorio) <> 1 then return
		
		SELECTBLOB 	MANUAL_MOF
			into 		:lbl_manual_mof
		FROM cargo cc
		where cc.cod_cargo = :ls_cod_cargo;
		  
		//Creo el archivo DOC
		if not IsNull(lbl_manual_mof) then
			li_FileNum = FileOpen(ls_Directorio + "\" + trim(ls_desc_cargo) +  " MOF.DOC", &
				StreamMode!, Write!, Shared!, Replace!)
	
			FileWriteEx(li_FileNum, lbl_manual_mof)
			FileClose(li_FileNum)
		end if
	
	
		MessageBox("Aviso", "Archivos generados satisfactoriamente", Information!)
	
	end if

catch ( exception ex )
	gnvo_app.of_catch_Exception(ex, "Error al hacer click en boton en el DAtaWindow Maestro")

finally
	destroy invo_wait
end try

end event

type tabpage_4 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Tarjetas de Proximidad"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
string picturename = "Custom081!"
long picturemaskcolor = 536870912
dw_tarjetas dw_tarjetas
end type

on tabpage_4.create
this.dw_tarjetas=create dw_tarjetas
this.Control[]={this.dw_tarjetas}
end on

on tabpage_4.destroy
destroy(this.dw_tarjetas)
end on

type dw_tarjetas from u_dw_abc within tabpage_4
integer width = 2935
integer height = 1124
integer taborder = 20
string dataobject = "d_abc_tarjeta_proximidad_trabajador_tbl"
end type

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                     // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
is_dwform = 'tabular'	// tabular, form (default)


ii_ck[1] = 1				// columnas de lectrua de este dw
ii_ck[2] = 2


idw_mst  = 	idw_tarjetas

end event

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event itemerror;call super::itemerror;Return 1
end event

event itemchanged;call super::itemchanged;Long   ll_count 
String ls_null

SetNull(ls_null)

Accepttext()


choose case dwo.name
		 case 'cod_tarjeta'
				select count(*) into :ll_count from rrhh_maestro_tarjeta
				 where (cod_tarjeta = :data )  and
				 		 (flag_estado = '1'   );



				if ll_count = 0 then
					Messagebox('Aviso','Tarjeta No Existe , Verifique')
					this.object.cod_tarjeta [row] = ls_null
					Return 1
				end if
end choose

end event

event doubleclicked;call super::doubleclicked;String ls_sql,ls_return1,ls_return2

if this.ii_protect = 1 or row = 0 then return


choose case dwo.name
		case 'cod_tarjeta'
			  		
		     ls_sql = "select cod_tarjeta as codigo ,fec_registro as fecha_registro ,fec_caducidad fecha_caducidad "&
			          +" from rrhh_maestro_tarjeta "&
						 +" where flag_estado  = "+"'"+'1'+"'"

                                                  
			  f_lista(ls_sql, ls_return1, ls_return2, '2')
		     if isnull(ls_return1) or trim(ls_return1) = '' then return
		     this.object.cod_tarjeta  [row] = ls_return1
			  dw_master.ii_update = 1	
end choose
end event

type tabpage_5 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Histórico de Cargos"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
string picturename = "EditStops5!"
long picturemaskcolor = 536870912
dw_cargos dw_cargos
end type

on tabpage_5.create
this.dw_cargos=create dw_cargos
this.Control[]={this.dw_cargos}
end on

on tabpage_5.destroy
destroy(this.dw_cargos)
end on

type dw_cargos from u_dw_abc within tabpage_5
integer width = 2935
integer height = 1124
integer taborder = 20
string dataobject = "d_abc_maestro_cargos_x_trab_tbl"
borderstyle borderstyle = styleraised!
end type

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                     // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
is_dwform = 'tabular'	// tabular, form (default)


ii_ck[1] = 1				// columnas de lectrua de este dw
ii_ck[2] = 2


idw_mst  = idw_cargos
end event

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event itemchanged;call super::itemchanged;Accepttext()
end event

event itemerror;call super::itemerror;Return 1
end event

event ue_insert_pre;call super::ue_insert_pre;String ls_cod_area

ls_cod_area = dw_master.object.cod_Area [1]

this.object.flag_estado [al_row] = '1'
this.object.cod_area	   [al_row] = ls_cod_area
end event

event doubleclicked;call super::doubleclicked;String ls_sql,ls_return1,ls_return2

if this.ii_protect = 1 or row = 0 then return


choose case dwo.name
		case 'cod_cargo'
			  		
		     ls_sql = "select cod_cargo as codigo ,desc_cargo as descripcion ,nivel as nivel "&
			          +" from cargo "&
						 +" where flag_estado  = "+"'"+'1'+"' and  nivel = 4 "

                                                  
			  f_lista(ls_sql, ls_return1, ls_return2, '2')
		     if isnull(ls_return1) or trim(ls_return1) = '' then return
		     this.object.cod_cargo  [row] = ls_return1
			  this.object.desc_cargo [row] = ls_return2
			  dw_master.ii_update = 1	
end choose
end event

type tabpage_7 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Establecimientos (RTPS)"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_establecimientos dw_establecimientos
end type

on tabpage_7.create
this.dw_establecimientos=create dw_establecimientos
this.Control[]={this.dw_establecimientos}
end on

on tabpage_7.destroy
destroy(this.dw_establecimientos)
end on

type dw_establecimientos from u_dw_abc within tabpage_7
event ue_display ( string as_columna,  long al_row )
integer width = 2935
integer height = 1124
integer taborder = 30
string dataobject = "d_abc_mov_establec_rtps_tbl"
borderstyle borderstyle = styleraised!
end type

event ue_display(string as_columna, long al_row);boolean 	lb_ret
string 	ls_codigo, ls_data, ls_sql, ls_nro_orden, &
			ls_oper_sec, ls_cencos, ls_desc_cencos, ls_cencos_r, ls_desc_cencos_r, &
			ls_dom
Long		ll_row_find

str_parametros sl_param

choose case upper(as_columna)
		
	case "COD_ESTABLECIMIENTO"

		ls_sql = "SELECT COD_ESTABLECIMIENTO AS CODIGO, " &
				  + "DENOMINACION AS DESCRIPCION " &
				  + "FROM RRHH_ESTABLECIMIENTOS_RTPS "&
				  + "where flag_estado = '1'"
				 
		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
		
		if ls_codigo <> '' then
			this.object.COD_ESTABLECIMIENTO	[al_row] = ls_codigo
			this.object.denominacion  			[al_row] = ls_data
			this.ii_update = 1
		end if
		
end choose
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                     // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
is_dwform = 'tabular'	// tabular, form (default)


ii_ck[1] = 1				// columnas de lectrua de este dw
ii_ck[2] = 2


idw_mst  = idw_cargos
end event

event doubleclicked;call super::doubleclicked;string 	ls_columna
long		ll_row

this.Accepttext( )
IF This.describe(dwo.Name + ".Protect") = '1' Then RETURN
ll_row = row

If ll_row > 0 Then
	ls_columna = upper(dwo.name)
	This.event dynamic ue_display(ls_columna, ll_row)
end if
end event

event itemchanged;call super::itemchanged;string 	ls_null, ls_mensaje, ls_desc

This.AcceptText()
if row = 0 then return
if dw_master.GetRow() = 0 then return

Setnull( ls_null)

CHOOSE CASE lower(dwo.name)
	
	CASE 'cod_establecimiento'

		SELECT denominacion 
			INTO :ls_desc
		FROM rrhh_establecimientos_rtps
   	WHERE cod_establecimiento = :data
		  and flag_estado = '1'; 
		  
		IF SQLCA.SQLCODE = 100 or SQLCA.SQLCode < 0 THEN
			if SQLCA.SQLCode = 100 then
				Messagebox('Aviso','Codigo de establecimiento no existe o ' &
					+ 'no esta activo, por favor verifique')
			else
				MessageBox('Aviso', SQLCA.SQLErrText)
			end if
			this.Object.cod_establecimiento	[row] = ls_null
			this.object.denominacion			[row] = ls_null
			this.setcolumn( "cod_establecimiento" )
		 	this.setfocus()
			RETURN 1
		END IF
		this.object.denominacion [row] = ls_desc
		
END CHOOSE

end event

event itemerror;call super::itemerror;Return 1
end event

event getfocus;call super::getfocus;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

type tabpage_8 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "Periodos Laborales"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_periodos_laborales dw_periodos_laborales
end type

on tabpage_8.create
this.dw_periodos_laborales=create dw_periodos_laborales
this.Control[]={this.dw_periodos_laborales}
end on

on tabpage_8.destroy
destroy(this.dw_periodos_laborales)
end on

type dw_periodos_laborales from u_dw_abc within tabpage_8
event ue_display ( string as_columna,  long al_row )
integer width = 2935
integer height = 1124
integer taborder = 30
string dataobject = "d_abc_periodos_laborales_rtps_tbl"
borderstyle borderstyle = styleraised!
end type

event ue_display;boolean 	lb_ret
string 	ls_codigo, ls_data, ls_sql, ls_origen
Long		ll_row_find

choose case upper(as_columna)	
	
	case "COD_TRABAJADOR"

		ls_sql = "SELECT  distinct m.cod_trabajador as codigo, " & 
		 			+ "nom_trabajador AS nombre " &
		 			+ "FROM vw_pr_trabajador m " &
					+ "where m.cod_origen = '" + gs_origen + "' and m.flag_estado = '1'"

		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
	
		if ls_codigo <> '' then
			this.object.cod_trabajador [al_row] = ls_codigo
			this.object.nombre         [al_row] = ls_data
			this.ii_update = 1
		end if
		
	case "COD_TIPO_EXTINCION"
		
		ls_sql = "SELECT  distinct m.cod_tipo_extincion as codigo, " & 
		 			+ "m.descripcion AS desc_extincion " &
		 			+ "FROM rrhh_tipo_ext_cont_rtps m " &
					+ "where m.flag_estado = '1'"

		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
	
		if ls_codigo <> '' then
			this.object.cod_tipo_extincion 	[al_row] = ls_codigo
			this.object.desc_tipo_extincion  [al_row] = ls_data
			this.ii_update = 1
		end if
		
	case "TIPO_DOC_LIQUIDACION"
		
		ls_sql = "select dt.tipo_doc as tipo_doc, " &
				 + "dt.desc_tipo_doc as descripcion_tipo_doc " &
				 + "from doc_tipo dt " &
				 + "where dt.flag_estado = '1'"

		lb_ret = f_lista(ls_sql, ls_codigo, ls_data, '2')
	
		if ls_codigo <> '' then
			this.object.TIPO_DOC_LIQUIDACION 	[al_row] = ls_codigo
			this.ii_update = 1
		end if

end choose
end event

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                     // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
is_dwform = 'tabular'	// tabular, form (default)


ii_ck[1] = 1				// columnas de lectrua de este dw
ii_ck[2] = 2


idw_mst  = idw_cargos
end event

event doubleclicked;call super::doubleclicked;string 	ls_columna
long		ll_row

this.Accepttext( )
IF This.describe(dwo.Name + ".Protect") = '1' Then RETURN
ll_row = row

If ll_row > 0 Then
	ls_columna = upper(dwo.name)
	This.event dynamic ue_display(ls_columna, ll_row)
end if
end event

event itemchanged;call super::itemchanged;String 	ls_null, ls_desc, ls_tipo_trabaj, ls_flag_sector_agrario, ls_cod_trabajador, ls_mensaje
Long 		ll_count
date		ld_fecha1, ld_fecha2
decimal	ldc_dias_periodo, ldc_dias_vacaciones, ldc_dias_asistencia
Integer	li_rpta

dw_master.Accepttext()
Accepttext()
SetNull( ls_null)

CHOOSE CASE dwo.name
	CASE 'tipo_doc_liquidacion'
		// Verifica que codigo ingresado exista			
		Select desc_tipo_doc
	     into :ls_desc
		  from doc_tipo
		 Where tipo_doc = :data 
		   and flag_estado = '1';
			
		// Verifica que articulo solo sea de reposicion		
		if SQLCA.SQLCode = 100 then
			Messagebox( "Error", "Tipo de Documento no existe")
			this.object.tipo_doc_liquidacion[row] = ls_null
			return 1
		end if
		
		this.object.nom_usuario		[row] = ls_desc
	
	case 'fec_inicio_periodo', 'fec_final_periodo'
		
	
		ls_cod_trabajador = this.object.cod_trabajador [row]
		if IsNull(ls_cod_trabajador) or ls_cod_trabajador = '' then
			MessageBox('Aviso', 'No se ha especificado el codigo de trabajador, debe grabar primero para generar el codigo de trabajador, en caso que sea nuevo registro; por favor verifique!', Information!)
			return
		end if
		
		ld_fecha1 = Date(this.object.fec_inicio_periodo	[row])
		ld_fecha2 = Date(this.object.fec_final_periodo	[row])
		
		if IsNull(ld_fecha2) then return
		
		if ld_fecha2 < ld_fecha1 then
			MessageBox('Error', 'La fecha final debe ser mayor o igual a la fecha de inicio del periodo laboral, por favor verifique!')
			this.object.fec_final_periodo [row] = gnvo_app.id_null
			this.object.dias_periodo		[row] = 0
			return
		end if
		
		ldc_dias_periodo = DaysAfter(ld_fecha1, ld_fecha2) + 1
		this.object.dias_periodo		[row] = ldc_dias_periodo
		
		ls_tipo_trabaj = dw_master.object.tipo_trabajador[dw_master.getRow()]
		
		if IsNull(ls_tipo_trabaj) or ls_tipo_trabaj = '' then
			MessageBox('Error', 'Debe Seleccionar el tipo de trabajador', StopSign!)
			dw_master.SetFocus()
			this.SetColumn('tipo_trabajador')
			return
		end if
		
		//Obtengo los días de asistencia
		select usp_sigre_rrhh.of_dias_asist(:ls_cod_trabajador, :ld_fecha1, :ld_fecha2)
			into :ldc_dias_asistencia
		from dual;
		
		if SQLCA.SQLCode < 0 then
			ls_mensaje = SQLCA.SQLErrText
			ROLLBACK;
			MessageBox('Error', 'Ha ocurrido un error al calcular los dias de asistencia. ' &
									+ 'Procedure usp_sigre_rrhh.of_dias_asist(). Mensaje: ' + ls_mensaje, &
									StopSign!)
			return
		end if
		
		
		//Obtengo el flag si pertenece o no al sector agrario
		ldc_dias_vacaciones = 30 
		
		//Pregunto si desea que se calcule las vacaciones
		li_rpta = MessageBox('Aviso', 'Desea que se calcule los días de vacaciones basados en los días de asistencia del personal?', Information!, Yesno!, 2)
		
		if li_rpta = 1 then
			
			MessageBox('Aviso de Asistencia', 'En el periodo indicando el trabajador tiene una asistencia de ' + string(ldc_dias_asistencia, '###,##0.00') + ' los cuales no incluyen domingos', Information!)
			
			ldc_dias_asistencia = ldc_dias_asistencia + truncate(ldc_dias_asistencia / 6, 0)
			
			if ldc_dias_asistencia > ldc_dias_periodo then ldc_dias_asistencia = ldc_dias_periodo
			
			//Genero el total de días basados en la asistencia
			//ldc_factor = ldc_dias_asistencia / ldc_dias
			
			//Calculo los días según el aproximado de días del periodo laboral ingresado
			ldc_dias_vacaciones = round(ldc_dias_vacaciones / 365 * ldc_dias_asistencia, 2)
		end if
			
		//Calculo los días según el aproximado de días del periodo laboral ingresado
		//ldc_dias = round(ldc_dias / 360 * ldc_dias_vacaciones,2) * ldc_factor
		
		this.object.nro_dias_vacac[row] = ldc_dias_vacaciones
		
END CHOOSE
end event

event itemerror;call super::itemerror;Return 1
end event

event ue_insert_pre;call super::ue_insert_pre;String 	ls_trabajador
int 		li_row, li_item
Date		ld_Fec_ingreso

ls_trabajador 	= dw_master.object.cod_trabajador 	[1]
ld_fec_ingreso	= Date(dw_master.object.fec_ingreso [1])

if IsNull(ld_fec_ingreso) then
	MEssageBox('Error', 'No se ha especificado la fecha de ingreso del trabajador, por favor corrija!', StopSign!)
	return
end if

this.object.cod_trabajador [al_row] = ls_trabajador

if al_row = 1 then
	this.object.fec_inicio_periodo [al_row] = ld_fec_ingreso
end if

li_item = 0
for li_row = 1 to al_row - 1
	if li_item < integer(this.object.item[li_row]) then
		li_item = integer(this.object.item[li_row])
	end if
next

li_item ++;

this.object.item						[li_row] = li_item
this.object.flag_liquidacion		[li_row] = '0'
this.object.vacaciones_gozadas	[li_row] = 0.00
this.object.nro_dias_vacac			[li_row] = 0.00
this.object.flag_is_renovable		[li_row] = '0'

end event

event keydwn;call super::keydwn;string ls_columna, ls_cadena
integer li_column
long ll_row

// La tecla F2 despliega el cuadro de ayuda dependiendo de que columna estes ubicado
if key = KeyF2! then
	this.AcceptText()
	li_column = this.GetColumn()
	if li_column <= 0 then
		return 0
	end if
	ls_cadena = "#" + string( li_column ) + ".Protect"
	If this.Describe(ls_cadena) = '1' then RETURN
	
	ls_cadena = "#" + string( li_column ) + ".Name"
	ls_columna = upper( this.Describe(ls_cadena) )
	
	ll_row = this.GetRow()
	if ls_columna <> "!" then
	 	this.event dynamic ue_display( ls_columna, ll_row )
	end if
end if
return 0
end event

event buttonclicked;call super::buttonclicked;String		ls_obs

str_parametros sl_param

IF row  = 0 THEN RETURN

ls_obs 		= This.object.obs 	[row]

CHOOSE CASE lower(dwo.name)
	CASE "b_obs"
		// Para la descripcion de la Factura
		sl_param.string1   = 'Observaciones para el Periodo Laborable'
		sl_param.string2	 = ls_obs
	
		OpenWithParm( w_descripcion, sl_param)
		
		IF isvalid(message.PowerObjectParm) THEN sl_param = message.PowerObjectParm			
		IF sl_param.titulo = 's' THEN
				This.object.obs [row] = sl_param.string3
				this.ii_update = 1
		END IF
END CHOOSE		
end event

type tabpage_9 from userobject within tab_1
integer x = 18
integer y = 112
integer width = 4466
integer height = 1156
long backcolor = 79741120
string text = "BASC"
long tabtextcolor = 8388608
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
tab_2 tab_2
end type

on tabpage_9.create
this.tab_2=create tab_2
this.Control[]={this.tab_2}
end on

on tabpage_9.destroy
destroy(this.tab_2)
end on

type tab_2 from tab within tabpage_9
integer x = 32
integer y = 32
integer width = 4370
integer height = 1036
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long backcolor = 79741120
boolean raggedright = true
boolean focusonbuttondown = true
boolean boldselectedtext = true
integer selectedtab = 1
tabpage_10 tabpage_10
tabpage_11 tabpage_11
tabpage_12 tabpage_12
tabpage_13 tabpage_13
tabpage_14 tabpage_14
tabpage_15 tabpage_15
tabpage_16 tabpage_16
end type

on tab_2.create
this.tabpage_10=create tabpage_10
this.tabpage_11=create tabpage_11
this.tabpage_12=create tabpage_12
this.tabpage_13=create tabpage_13
this.tabpage_14=create tabpage_14
this.tabpage_15=create tabpage_15
this.tabpage_16=create tabpage_16
this.Control[]={this.tabpage_10,&
this.tabpage_11,&
this.tabpage_12,&
this.tabpage_13,&
this.tabpage_14,&
this.tabpage_15,&
this.tabpage_16}
end on

on tab_2.destroy
destroy(this.tabpage_10)
destroy(this.tabpage_11)
destroy(this.tabpage_12)
destroy(this.tabpage_13)
destroy(this.tabpage_14)
destroy(this.tabpage_15)
destroy(this.tabpage_16)
end on

type tabpage_10 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Inf.General"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_basc_infgen dw_basc_infgen
end type

on tabpage_10.create
this.dw_basc_infgen=create dw_basc_infgen
this.Control[]={this.dw_basc_infgen}
end on

on tabpage_10.destroy
destroy(this.dw_basc_infgen)
end on

type dw_basc_infgen from u_dw_abc within tabpage_10
integer width = 2953
integer height = 864
string dataobject = "d_abc_maestro_personal_basc_infgen_tbl"
boolean hscrollbar = false
boolean vscrollbar = false
borderstyle borderstyle = styleraised!
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
	                  // 'md' = master con detalle, 'dd' = detalle con detalle a la vez
//is_dwform = 'tabular'	// tabular, form (default)



ii_ck[1] = 1				// columnas de lectrua de este dw


idw_mst = dw_master

end event

event itemchanged;call super::itemchanged;String ls_desc,ls_null,ls_pais,ls_dpto,ls_prov

Setnull(ls_null)

dw_master.ii_update = 1

choose case dwo.name
		 case 'basc_valor_activos','basc_gasto_mensual','basc_valor_total_deuda'
			
				if dec(data)<0 then
					SetItem(row,dwo.name,0)
					return 1
				end if			
		
end choose
end event

event itemerror;call super::itemerror;Return 1
end event

type tabpage_11 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Ciudades.Visitadas"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_basc_ciuvis dw_basc_ciuvis
end type

on tabpage_11.create
this.dw_basc_ciuvis=create dw_basc_ciuvis
this.Control[]={this.dw_basc_ciuvis}
end on

on tabpage_11.destroy
destroy(this.dw_basc_ciuvis)
end on

type dw_basc_ciuvis from u_dw_abc within tabpage_11
integer width = 3214
integer height = 868
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_abc_maestro_personal_basc_ciudvisitadas_tbl"
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;ii_ck[1] = 1				// columnas de lectrua de este dw
is_dwform = 'grid'	
end event

event itemchanged;call super::itemchanged;

idw_1 = this

		idw_1.GetText()
		idw_1.AcceptText()

end event

event itemerror;call super::itemerror;RETURN 1
end event

event ue_insert_pre;call super::ue_insert_pre;Int j, ln_num = 0

this.object.cod_usr				[al_row] = gs_user
this.object.fec_registro [al_row] = datetime(today(),now())

For j = 1 to this.rowcount()
	if this.object.nro_item[j] > ln_num then
		ln_num = this.object.nro_item[j]
	end if
Next

this.object.nro_item[al_row] = ln_num + 1
end event

type tabpage_12 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Estudios.Realizados"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_estrea dw_estrea
end type

on tabpage_12.create
this.dw_estrea=create dw_estrea
this.Control[]={this.dw_estrea}
end on

on tabpage_12.destroy
destroy(this.dw_estrea)
end on

type dw_estrea from u_dw_abc within tabpage_12
integer width = 3392
integer height = 868
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_abc_maestro_personal_basc_estrea_tbl"
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;ii_ck[1] = 1				// columnas de lectrua de este dw
is_dwform = 'grid'	
end event

event itemchanged;call super::itemchanged;

idw_1 = this

		idw_1.GetText()
		idw_1.AcceptText()

end event

event itemerror;call super::itemerror;RETURN 1
end event

event ue_insert_pre;call super::ue_insert_pre;Int j, ln_num = 0

this.object.cod_usr				[al_row] = gs_user
this.object.fec_registro [al_row] = datetime(today(),now())

For j = 1 to this.rowcount()
	if this.object.nro_item[j] > ln_num then
		ln_num = this.object.nro_item[j]
	end if
Next

this.object.nro_item[al_row] = ln_num + 1
end event

type tabpage_13 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Activos.Financieros"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_actfin dw_actfin
end type

on tabpage_13.create
this.dw_actfin=create dw_actfin
this.Control[]={this.dw_actfin}
end on

on tabpage_13.destroy
destroy(this.dw_actfin)
end on

type dw_actfin from u_dw_abc within tabpage_13
integer width = 3310
integer height = 868
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_abc_maestro_personal_basc_actfin_tbl"
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;ii_ck[1] = 1				// columnas de lectrua de este dw
is_dwform = 'grid'	
end event

event itemchanged;call super::itemchanged;idw_1 = this
idw_1.GetText()
idw_1.AcceptText()
string ls_desc, ls_null
setnull(ls_null)
if dwo.name = 'tipo_activo' then
				
				select desc_activo into :ls_desc
				  from basc_rrhh_tipo_actfin
				 where (trim(tipo_activo) = trim(:data));
				
				if sqlca.sqlcode = 100 then
					
					this.object.tipo_activo  [row] = ls_null
					this.object.tipo_desc_activo [row] = ls_null
					Messagebox(this.title, 'Tipo Inexistente')
					Return 1
				else
					this.object.tipo_desc_activo [row] = ls_desc
				end if
end if

end event

event itemerror;call super::itemerror;RETURN 1
end event

event ue_insert_pre;call super::ue_insert_pre;Int j, ln_num = 0

this.object.cod_usr				[al_row] = gs_user
this.object.fec_registro [al_row] = datetime(today(),now())

For j = 1 to this.rowcount()
	if this.object.nro_item[j] > ln_num then
		ln_num = this.object.nro_item[j]
	end if
Next

this.object.nro_item[al_row] = ln_num + 1
end event

event doubleclicked;call super::doubleclicked;if row > 0 then
	string ls_sql, ls_return1, ls_return2
	if dwo.name = 'tipo_activo' then
		ls_sql = "select tipo_activo as codigo, desc_activo as descripcion from basc_rrhh_tipo_actfin where flag_estado='1'" 
		 		f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.tipo_activo [row] = ls_return1
				this.object.tipo_desc_activo[row] = ls_return2
				this.ii_update = 1
	end if
end if
end event

type tabpage_14 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Otras.Ctas.Bancarias"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_otrcta dw_otrcta
end type

on tabpage_14.create
this.dw_otrcta=create dw_otrcta
this.Control[]={this.dw_otrcta}
end on

on tabpage_14.destroy
destroy(this.dw_otrcta)
end on

type dw_otrcta from u_dw_abc within tabpage_14
integer width = 3127
integer height = 868
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_abc_maestro_personal_basc_otrascuentas_tbl"
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;ii_ck[1] = 1				// columnas de lectrua de este dw
is_dwform = 'grid'	
end event

event itemchanged;call super::itemchanged;idw_1 = this
idw_1.GetText()
idw_1.AcceptText()
string ls_desc, ls_null
setnull(ls_null)
if dwo.name = 'cod_banco' then
				
				select nom_banco into :ls_desc
				  from banco
				 where (trim(cod_banco) = trim(:data));
				
				if sqlca.sqlcode = 100 then
					
					this.object.cod_banco  [row] = ls_null
					this.object.nom_banco [row] = ls_null
					Messagebox(this.title, 'Banco Inexistente')
					Return 1
				else
					this.object.nom_banco [row] = ls_desc
				end if
end if

end event

event itemerror;call super::itemerror;RETURN 1
end event

event ue_insert_pre;call super::ue_insert_pre;Int j, ln_num = 0

this.object.cod_usr				[al_row] = gs_user
this.object.fec_registro [al_row] = datetime(today(),now())

For j = 1 to this.rowcount()
	if this.object.nro_item[j] > ln_num then
		ln_num = this.object.nro_item[j]
	end if
Next

this.object.nro_item[al_row] = ln_num + 1
end event

event doubleclicked;call super::doubleclicked;if row > 0 then
	string ls_sql, ls_return1, ls_return2
	if dwo.name = 'cod_banco' then
		ls_sql = "select cod_banco as codigo, nom_banco as descripcion from banco" 
		 		f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				this.object.cod_banco [row] = ls_return1
				this.object.nom_banco[row] = ls_return2
				this.ii_update = 1
	end if
end if
end event

type tabpage_15 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Sociedades.Comerciales"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
dw_soccom dw_soccom
end type

on tabpage_15.create
this.dw_soccom=create dw_soccom
this.Control[]={this.dw_soccom}
end on

on tabpage_15.destroy
destroy(this.dw_soccom)
end on

type dw_soccom from u_dw_abc within tabpage_15
integer width = 3314
integer height = 868
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_abc_maestro_personal_basc_soccom_tbl"
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;ii_ck[1] = 1				// columnas de lectrua de este dw
is_dwform = 'grid'	
end event

event itemchanged;call super::itemchanged;

idw_1 = this

		idw_1.GetText()
		idw_1.AcceptText()

end event

event itemerror;call super::itemerror;RETURN 1
end event

event ue_insert_pre;call super::ue_insert_pre;Int j, ln_num = 0

this.object.cod_usr				[al_row] = gs_user
this.object.fec_registro [al_row] = datetime(today(),now())

For j = 1 to this.rowcount()
	if this.object.nro_item[j] > ln_num then
		ln_num = this.object.nro_item[j]
	end if
Next

this.object.nro_item[al_row] = ln_num + 1
end event

type tabpage_16 from userobject within tab_2
integer x = 18
integer y = 104
integer width = 4334
integer height = 916
long backcolor = 79741120
string text = "Docs.Escaneados"
long tabtextcolor = 33554432
long tabbackcolor = 79741120
long picturemaskcolor = 536870912
st_5 st_5
dw_docesc dw_docesc
cb_3 cb_3
sle_tipodocescaneado sle_tipodocescaneado
st_3 st_3
cb_1 cb_1
sle_rutaarchivo sle_rutaarchivo
sle_archiobs sle_archiobs
st_4 st_4
dp_1 dp_1
st_2 st_2
cb_2 cb_2
end type

on tabpage_16.create
this.st_5=create st_5
this.dw_docesc=create dw_docesc
this.cb_3=create cb_3
this.sle_tipodocescaneado=create sle_tipodocescaneado
this.st_3=create st_3
this.cb_1=create cb_1
this.sle_rutaarchivo=create sle_rutaarchivo
this.sle_archiobs=create sle_archiobs
this.st_4=create st_4
this.dp_1=create dp_1
this.st_2=create st_2
this.cb_2=create cb_2
this.Control[]={this.st_5,&
this.dw_docesc,&
this.cb_3,&
this.sle_tipodocescaneado,&
this.st_3,&
this.cb_1,&
this.sle_rutaarchivo,&
this.sle_archiobs,&
this.st_4,&
this.dp_1,&
this.st_2,&
this.cb_2}
end on

on tabpage_16.destroy
destroy(this.st_5)
destroy(this.dw_docesc)
destroy(this.cb_3)
destroy(this.sle_tipodocescaneado)
destroy(this.st_3)
destroy(this.cb_1)
destroy(this.sle_rutaarchivo)
destroy(this.sle_archiobs)
destroy(this.st_4)
destroy(this.dp_1)
destroy(this.st_2)
destroy(this.cb_2)
end on

type st_5 from statictext within tabpage_16
integer x = 50
integer y = 404
integer width = 466
integer height = 60
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Archivos Subidos:"
boolean focusrectangle = false
end type

type dw_docesc from u_dw_abc within tabpage_16
integer x = 32
integer y = 484
integer width = 3593
integer height = 416
integer taborder = 20
boolean bringtotop = true
string dataobject = "d_abc_maestro_personal_basc_docesc_tbl"
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!

if dwo.name = 'eliminar' and row > 0 then
	if MessageBox('Aviso','¿Esta Seguro de eliminar el archivo?',Question!,yesNo!,2) = 1 then
		this.deleterow(row)
		this.update()
		commit;
	else
		this.object.eliminar[row] = '0'
		return 1
	end if
end if
end event

event constructor;call super::constructor;ii_ck[1] = 1				// columnas de lectrua de este dw
is_dwform = 'grid'	
end event

event itemerror;call super::itemerror;RETURN 1
end event

event ue_insert;//override
return 0

end event

event doubleclicked;call super::doubleclicked;
if row > 0 then
	
	if Messagebox('Aviso','¿Desea descargar el archivo a su computadora',Question!,YesNo!,2) = 1 then
		
		//codigo para abrir documento pdf que se encuentra en un BLOB
		blob lbl_pdfdoc, lbl_null
		string ls_codinc, ls_prov
		integer li_nroitem
		
		// obteniendo valores
		li_nroitem = This.Object.nro_item[row]
		ls_prov = dw_master.Object.cod_trabajador[dw_master.getrow()]
		
		string ls_rutaarchivo, ls_nombrearchivo
		integer li_filenum, li_write_error
		
		ls_nombrearchivo = this.object.nombre_archivo[row]
		
		//se verifica si existe archivo
		if directoryexists("C:\documentos_sigre") = false then
			if createdirectory("C:\documentos_sigre") <> 1 then
				MessageBox('Aviso','No se pudo crear directorio en "C:\documentos_sigre" para guardar el archivo')
				return
			end if
		end if
		
		// se puede establecer cualquier ruta donde tenga permisos de escritura el usuario
		ls_rutaarchivo = "C:\documentos_sigre\"+ls_nombrearchivo

		if fileexists(ls_rutaarchivo) then
			MessageBox('Aviso','Ya existe un archivo con el mismo nombre en el directorio "C:\documentos_sigre". No se podra continuar')
			return
		end if
		
		SetPointer(HourGlass!)
		
		// obteniendo blob
		selectblob documento
				into :lbl_pdfdoc
				from basc_rrhh_documentos_trab
			  where cod_trabajador = :ls_prov
			     and nro_item = :li_nroitem;
		
		if isnull(lbl_pdfdoc) or lbl_pdfdoc = lbl_null then
			messagebox('Aviso','No Existe Documento Adjunto, revise por favor')
			SetPointer(Arrow!)
			return
		end if
				
		// se tiene que abrir con los siguientes permisos para poder sobre escribir
		li_filenum = FileOpen(ls_rutaarchivo, StreamMode!, Write!, LockWrite!, Replace!)
		
		if li_filenum = -1 then
			messagebox('Aviso','No se puede abrir documento PDF por que no tiene acceso al directorio')
			SetPointer(Arrow!)
			return
		end if
		
		li_Write_Error = FileWriteEx(li_filenum, lbl_pdfdoc)
		
		if li_Write_Error = -1 then
			messagebox('Aviso','No se puede guardar documento TEMPORAL por que no tiene acceso al directorio')
			SetPointer(Arrow!)
			return
		end if
		
		FileClose(li_filenum)
		SetPointer(Arrow!)
		
		MessageBox('Aviso','Se guardo el documento exitosamente en "C:\documentos_sigre"');
		run('explorer.exe C:\documentos_sigre')
		
	end if
	
end if
end event

type cb_3 from commandbutton within tabpage_16
integer x = 1888
integer y = 156
integer width = 165
integer height = 100
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "..."
end type

event clicked;
	string ls_sql, ls_return1, ls_return2

		ls_sql = "select tipo_doc as codigo, desc_tipo_doc as descripcion from basc_rrhh_tipo_documento" 
		 		f_lista(ls_sql, ls_return1, ls_return2, '2')
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				sle_tipodocescaneado.text = ls_return1



end event

type sle_tipodocescaneado from singlelineedit within tabpage_16
integer x = 1687
integer y = 156
integer width = 165
integer height = 100
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
textcase textcase = upper!
integer limit = 2
borderstyle borderstyle = stylelowered!
end type

event modified;if this.text <> '' and not isnull(this.text) then
				
				string ls_null, ls_desc
				
				select desc_tipo_doc into :ls_desc
				  from basc_rrhh_tipo_documento
				 where tipo_doc= :this.text;
				
				if sqlca.sqlcode = 100 then
					
					this.text = ''
					Messagebox('Aviso', 'Tipo de Documento Inexistente')
				end if
end if

end event

type st_3 from statictext within tabpage_16
integer x = 1010
integer y = 188
integer width = 635
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Tipo Documento Escaneado:"
alignment alignment = right!
boolean focusrectangle = false
end type

type cb_1 from commandbutton within tabpage_16
integer x = 2446
integer y = 96
integer width = 343
integer height = 100
integer taborder = 50
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Añadir"
end type

event clicked;string ls_ruta, ls_obs, ls_prov, ls_tipodoc
date ld_fecvis
time lt_now

ls_ruta = sle_rutaarchivo.text

if fileexists(ls_ruta) = false then
	MessageBox("Aviso","El archivo ingresado no existe",StopSign!)
	return
end if

ls_obs = sle_archiobs.text

if ls_obs = '' or isnull(ls_obs) then
	if MessageBox("Aviso","¿Esta seguro de adjuntar el archivo sin observaciones?",Question!,YesNo!,2) = 2 then
		return
	end if
end if

ls_tipodoc = sle_tipodocescaneado.text

if ls_tipodoc = '' or isnull(ls_tipodoc) then
	MessageBox("Aviso","Debe Ingresar un tipo de documento a escanear")
	sle_tipodocescaneado.SetFocus()
	return
end if

dp_1.getvalue(ld_fecvis,lt_now)

ls_prov = dw_master.Object.cod_trabajador[dw_master.getrow()]

if ls_prov = '' or isnull(ls_prov) then
	MessageBox("Aviso","Debe guardar el registro del TRABAJADOR para poder adjuntar un archivo",StopSign!)
	return
end if

integer li_ret, li_filenum, li_nroitem
blob lbl_doc

// 3.- se abre el archivo
li_filenum = FileOpen(ls_ruta, StreamMode!)

if li_filenum <= 0 then
	MessageBox('Aviso','No se pudo abrir el archivo solicitado')
	return
end if

// 4.- se lee el archivo
li_ret = FileReadEx(li_filenum, lbl_doc)

if li_ret <> -100 and li_ret <> -1 and li_ret <> 0 then
			
	// 5.- se actualiza columna en BD
	FileClose(li_filenum)
	
	SetPointer(Hourglass!)
	
	select count(1) + 1
	 into 	:li_nroitem
	 from basc_rrhh_documentos_trab
	where cod_trabajador = :ls_prov;
	
	if gnvo_app.of_existserror(sqlca) then
		SetPointer(Arrow!)
		return
	end if
	 
	// insertando documento
	insert into basc_rrhh_documentos_trab ( cod_trabajador, nro_item, fec_registro, fec_documento, cod_usr, obs, nombre_archivo, tipo_doc) 
		 values ( :ls_prov, :li_nroitem, sysdate, :ld_fecvis, :gs_user, :ls_obs, :is_nombre_archivo, :ls_tipodoc );	
	
	if gnvo_app.of_existserror(sqlca) then
		SetPointer(Arrow!)
		return
	end if
	
	// guardando blob
	updateblob basc_rrhh_documentos_trab
			 set documento = :lbl_doc
		  where cod_trabajador = :ls_prov
			 and nro_item = :li_nroitem;
	
	SetPointer(Arrow!)
	
	if gnvo_app.of_existserror(sqlca) then
		return
	end if
	
	commit;
	
	MessageBox('Aviso','El documento se guardo exitosamente')
	
	sle_rutaarchivo.text = ""
	is_nombre_archivo = ''
	sle_archiobs.text = ''
	sle_tipodocescaneado.text = ''
	
	dw_docesc.retrieve(ls_prov)

else
	MessageBox('Aviso','Ocurrio un error al leer el archivo',StopSign!)
end if
end event

type sle_rutaarchivo from singlelineedit within tabpage_16
integer x = 507
integer y = 60
integer width = 1797
integer height = 80
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type sle_archiobs from singlelineedit within tabpage_16
integer x = 507
integer y = 276
integer width = 1797
integer height = 80
integer taborder = 40
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
textcase textcase = upper!
integer limit = 100
borderstyle borderstyle = stylelowered!
end type

type st_4 from statictext within tabpage_16
integer x = 119
integer y = 292
integer width = 361
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Observaciones:"
alignment alignment = right!
boolean focusrectangle = false
end type

type dp_1 from datepicker within tabpage_16
integer x = 507
integer y = 156
integer width = 471
integer height = 100
integer taborder = 30
boolean border = true
borderstyle borderstyle = stylelowered!
string customformat = "dd/MM/yyyy"
date maxdate = Date("2999-12-31")
date mindate = Date("1800-01-01")
datetime value = DateTime(Date("2024-05-31"), Time("09:25:35.000000"))
integer textsize = -8
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
integer calendarfontweight = 400
boolean todaysection = true
boolean todaycircle = true
end type

type st_2 from statictext within tabpage_16
integer x = 137
integer y = 188
integer width = 343
integer height = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 67108864
string text = "Fecha Visita:"
alignment alignment = right!
boolean focusrectangle = false
end type

type cb_2 from commandbutton within tabpage_16
integer x = 50
integer y = 48
integer width = 434
integer height = 100
integer taborder = 30
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
string text = "Buscar Archivo..."
end type

event clicked;string docpath, docname[]
integer i, li_cnt, li_rtn, li_filenum

li_rtn = GetFileOpenName("Select File", &
   docpath, docname[], "DOC", &
   + "Text Files (*.PDF),*.PDF," &
   + "Doc Files (*.DOCX),*.DOCX," &
   + "All Files (*.*), *.*", &
   "C:\", 18)

sle_rutaarchivo.text = ""
is_nombre_archivo = ''

IF li_rtn < 1 THEN return
li_cnt = Upperbound(docname)

// if only one file is picked, docpath contains the 
// path and file name
if li_cnt = 1 then
   sle_rutaarchivo.text = string(docpath)
   is_nombre_archivo = docname[1]
else
	MessageBox('Aviso','Debe seleccionar unicamente un archivo')
end if
end event

type dw_master from u_dw_abc within w_rh030_abc_maestro_personal
integer x = 1499
integer y = 12
integer width = 3543
integer height = 860
integer taborder = 20
string dataobject = "d_abc_maestro_personal_tbl"
boolean hscrollbar = false
boolean vscrollbar = false
borderstyle borderstyle = styleraised!
end type

event clicked;call super::clicked;idw_1.BorderStyle = StyleRaised!
idw_1 = THIS
idw_1.BorderStyle = StyleLowered!
end event

event constructor;call super::constructor;is_mastdet = 'm'		// 'm' = master sin detalle (default), 'd' =  detalle,
                       	// 'md' = master con detalle, 'dd' = detalle con detalle a la vez



ii_ck[1] = 1				// columnas de lectrua de este dw



idw_mst = dw_master

end event

event itemchanged;call super::itemchanged;String ls_codigo, ls_nombre

Accepttext()

choose case dwo.name
	case 'tipo_trabajador'
		SELECT tt.DESC_TIPO_TRA  
			into :ls_nombre
   	FROM Tipo_Trabajador tt,
         	tipo_trabajador_user ttu
   	WHERE tt.tipo_trabajador 	= ttu.tipo_trabajador
     	  and ttu.cod_usr 			= :gs_user
		  and tt.tipo_trabajador 	= :data
     	  and tt.FLAG_ESTADO 		= '1'; 
			 
		if sqlca.sqlcode = 100 then
			this.object.tipo_trabajador	[row] = gnvo_app.is_null
			this.object.desc_tipo_tra		[row] = gnvo_app.is_null
			Messagebox(this.title, 'Tipo Trabajador ' + data + ' Inexistente o no esta activo o no tiene permitido usarlo, por favor verifique!')
			Return 1
		end if
		
		this.object.desc_tipo_tra[row] = ls_nombre

			
	 case 'cencos'
			select desc_cencos into :ls_nombre
			  from centros_costo
			 where (cencos      = :data) and
					 (flag_estado = '1'  );
					  
			if sqlca.sqlcode = 100 then
				this.object.desc_cencos[row] = gnvo_app.is_null
				Messagebox(this.title, 'Centro de Costo Inexistente o no esta activo, por favor verifique!')
				Return 1
			end if
			
			this.object.desc_cencos[row] = ls_nombre
			
	 case 'cod_area'
			select desc_area into :ls_nombre
			 from area
			where (trim(cod_area) = trim(:data)) ;
		
			if sqlca.sqlcode = 100 then
				this.object.cod_area     [row] = gnvo_app.is_null
				this.object.desc_area    [row] = gnvo_app.is_null
				this.object.cod_seccion  [row] = gnvo_app.is_null
				this.object.desc_seccion [row] = gnvo_app.is_null
				Messagebox(this.title, 'Area Inexistente por favor verifique!')
				Return 1
			end if
			
			this.object.desc_area    [row] = ls_nombre
			this.object.cod_seccion  [row] = gnvo_app.is_null
			this.object.desc_seccion [row] = gnvo_app.is_null

	
	
	 case 'cod_seccion'
			ls_codigo = this.object.cod_area[row]
	  
			if Isnull(ls_codigo) or Trim(ls_codigo) = '' then 
				messagebox(parent.title, 'Ingrese el área', stopsign!)
				Return 1
			end if
	
			select desc_seccion 
				into :ls_nombre
			  from seccion 
			 where (trim(cod_area)    = trim(:ls_codigo ) ) and
					 (trim(cod_seccion) = trim(:data)	    ) ;
		
			if sqlca.sqlcode =  100 then
				
				this.object.cod_seccion  [row] = gnvo_app.is_null
				this.object.desc_seccion [row] = gnvo_app.is_null
				Messagebox(this.title, 'Sección Inexistente, por favor verifique!')
				Return 1	 
			end if
			
			this.object.desc_seccion[row] = ls_nombre
			
		
end choose


end event

event itemerror;call super::itemerror;Return 1
end event

event ue_insert_pre;call super::ue_insert_pre;string ls_Desc_origen

this.object.cod_usr 					[al_row] = gs_user
This.object.flag_estado 			[al_row] = '1'
this.object.flag_cal_plnlla 		[al_row] = '1'
this.object.flag_comision_afp 	[al_row] = '0'

this.object.porc_judicial	 		[al_row] = 0.00
this.object.porc_jud_util 			[al_row] = 0.00
this.object.porc_jud_cts 			[al_row] = 0.00
this.object.porc_jud_grat 			[al_row] = 0.00
this.object.porc_jud_vacac 		[al_row] = 0.00

this.object.porc_adel_quincena	[al_row] = 0.00


this.object.cod_moneda 				[al_row] = gnvo_app.is_soles
this.object.flag_sindicato 		[al_row] = '0'
this.object.flag_quincena	 		[al_row] = '0'
this.object.flag_domiciliado 		[al_row] = '1'
this.object.flag_dscto_comedor	[al_row] = '0'
this.object.flag_sctr_salud 		[al_row] = '0'
this.object.flag_essalud_vida 	[al_row] = '0'
this.object.flag_pensionista 		[al_row] = '0'
this.object.flag_sctr_pension 	[al_row] = '0'
this.object.flag_discapacidad		[al_row] = '0'






select nombre
	into :ls_Desc_origen
from origen
where cod_origen = :gs_origen;

this.object.cod_origen				[al_row] = gs_origen
this.object.desc_origen				[al_row] = ls_Desc_origen

//Desbloquear
dw_master.ii_protect 				= 1
idw_detail.ii_protect 				= 1
idw_detail_carga.ii_protect 		= 1
idw_tarjetas.ii_protect 			= 1
idw_cargos.ii_protect 				= 1
idw_establecimientos.ii_protect 	= 1
idw_basc_infgen.ii_protect 		= 1
idw_basc_ciuvis.ii_protect 		= 1
idw_basc_estrea.ii_protect 		= 1
idw_basc_actfin.ii_protect 		= 1
idw_basc_otrcta.ii_protect 		= 1
idw_basc_soccom.ii_protect 		= 1
idw_basc_docesc.ii_protect 		= 1
parent.event ue_modify()



of_load_foto('NONE')
end event

event buttonclicked;call super::buttonclicked;String	ls_docname, ls_named, ls_codtra
integer	li_Result
n_cst_maestro	lnvo_Master
str_parametros	lstr_param


choose case lower(dwo.name)
	case 'b_foto'
		li_result = GetFileOpenName("Seleccione Fotografía", &
						ls_docname, ls_named, "BMP", &
						"Archivos BMP (*.BMP),*.BMP,Archivos JPG (*.JPG),*.JPG, Archivos GIF (*.GIF),*.GIF")
	
		if li_result = 1 then
				
				ls_codtra = dw_master.object.cod_trabajador[dw_master.getRow()]
				
				if ls_codtra = "" or IsNull(ls_codtra) then
					MessageBox('Error', 'El codigo de trabajador esta en blanco, '&
											+ 'asegurese de grabar los datos antes de asignar la foto')
					return
				end if

				lnvo_Master = create n_cst_maestro
				lnvo_Master.of_grabar_foto( ls_docname, ls_codtra)
				destroy lnvo_Master
				
				of_load_foto(ls_codtra)
		end if
		
	case 'b_comentarios'
		//If this.is_protect("apel_paterno", row) then RETURN
		if this.ii_protect = 1 then return
		
		if MessageBox('Aviso', 'Desea agregar los comentarios para el trabajador?', Information!, YesNo!, 2) = 2 then return
		
		// Para la descripcion de la Factura
		lstr_param.string1   = 'Ingrese el comentario al trabajador'
		lstr_param.string2	 = this.object.comentario [row]
	
		OpenWithParm( w_descripcion_fac, lstr_param)
		
		IF isvalid(message.PowerObjectParm) THEN lstr_param = message.PowerObjectParm			
		IF lstr_param.titulo = 's' THEN
				This.object.comentario [row] = left(lstr_param.string3, 2000)
				this.ii_update = 1
		END IF	

END CHOOSE

end event

event ue_display;call super::ue_display;String  ls_docname , ls_named ,ls_return1 , ls_return2 ,ls_codigo ,ls_sql ,ls_cod_area
Integer li_file
boolean lb_ret

if this.ii_protect = 1 or al_row = 0 then return


choose case lower(as_columna)
		 case 'cencos'

				ls_sql = "select cencos as codigo ,desc_cencos as descripcion from centros_costo where flag_estado = "+"'"+'1'+"'"
				f_lista(ls_sql, ls_return1, ls_return2, '2')
				
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				
				this.object.cencos	   [al_row] = ls_return1
				this.object.desc_cencos [al_row] = ls_return2
				this.ii_update = 1
				
      case 'centro_benef'
		     ls_sql = "select centro_benef as codigo, " &
			  			+ "desc_centro as descripcion " &
						+ "from centro_beneficio "&
						+ " where flag_estado  = '1'"

                                                  
			  f_lista(ls_sql, ls_return1, ls_return2, '2')
		     if isnull(ls_return1) or trim(ls_return1) = '' then return
		     this.object.centro_benef  		[al_row] = ls_return1
		     this.object.desc_centro_benef  [al_row] = ls_return2 	

			  dw_master.ii_update = 1	
				
		 case 'foto_trabaj'
				li_file = GetFileOpenName("Seleccione Fotografía", ls_docname, ls_named, "BMP", "Archivos BMP (*.BMP),*.BMP,Archivos JPG (*.JPG),*.JPG, Archivos GIF (*.GIF),*.GIF")

				if li_file = 1 then
				   this.object.foto_trabaj[al_row] = ls_docname
					this.ii_update = 1
				end if
				
  		 case 'tipo_trabajador'
				
				ls_sql = "SELECT distinct " &
						 + "       tt.TIPO_TRABAJADOR as tipo_trabajador, " &
						 + "       tt.DESC_TIPO_TRA as desc_tipo_trabajador " &
						 + "  FROM Tipo_Trabajador tt, " &
						 + "       tipo_trabajador_user ttu " &
						 + "WHERE tt.tipo_trabajador = ttu.tipo_trabajador " &
						 + "  and ttu.cod_usr = '" + gs_user + "'" &
						 + "  and tt.FLAG_ESTADO = '1' " &
						 + "ORDER BY tt.TIPO_TRABAJADOR ASC"
						 
				if gnvo_app.of_lista(ls_sql, ls_return1, ls_return2, '2') then 
					this.object.tipo_trabajador [al_row] = ls_return1
					this.object.desc_tipo_tra   [al_row] = ls_return2
					this.ii_update = 1
				end if
				
		 case 'cod_area'
				ls_sql = "select cod_area as codigo, desc_area as descripcion from area"
				f_lista(ls_sql, ls_return1, ls_return2, '2')
				
				if isnull(ls_return1) or trim(ls_return1) = '' then return
				
				this.object.cod_area     [al_row] = ls_return1
				this.object.desc_area    [al_row] = ls_return2
				this.object.cod_seccion  [al_row] = gnvo_app.is_null
				this.object.desc_seccion [al_row] = gnvo_app.is_null
				this.ii_update = 1
				
	    case 'cod_seccion'
			
				ls_codigo = this.object.cod_area [al_row]
				
				if Isnull(ls_codigo) or trim(ls_codigo) = '' then 
					Messagebox(parent.title, 'Ingrese el área', stopsign!)
					Return
				end if
				
				ls_sql = "select cod_seccion as codigo, desc_seccion as descripcion from seccion where cod_area = '" + trim(ls_codigo) + "'"
				
				f_lista(ls_sql, ls_return1, ls_return2, '2')
				
				if Isnull(ls_return1) or trim(ls_return1) = '' then return
				
				this.object.cod_seccion  [al_row] = ls_return1
				this.object.desc_seccion [al_row] = ls_return2
				this.ii_update = 1

		

end choose

end event

event doubleclicked;call super::doubleclicked;string ls_columna, ls_string, ls_evaluate

THIS.AcceptText()

ls_string = this.Describe(lower(dwo.name) + '.Protect' )
if len(ls_string) > 1 then
 	ls_string = Mid(ls_string, Pos(ls_string, '~t') + 1)
 	ls_string = Mid(ls_string,1, len(ls_string) - 1 )
 	ls_evaluate = "Evaluate('" + ls_string + "', " + string(row) + ")"
 
 	if this.Describe(ls_evaluate) = '1' then return
else
 	if ls_string = '1' then return
end if

IF row > 0 THEN
	ls_columna = upper(dwo.name)
	THIS.event dynamic ue_display(ls_columna, row)
END IF
end event

